<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.147.7"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://booiris.space/wiki/leetcode/1157-online-majority-element-in-subarray/"><link rel=canonical href=https://booiris.space/wiki/leetcode/1157-online-majority-element-in-subarray/><link rel=apple-touch-icon href=/avatar.svg><link rel=icon href=/avatar.svg><link rel=shortcut href=/avatar.svg><link rel=alternate type=application/atom+xml href=https://booiris.space/index.xml title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/booiris.space\/"},"articleSection":"wiki","name":"1157-Online Majority Element In Subarray","headline":"1157-Online Majority Element In Subarray","description":"题意 设计一个数据结构，有效地找到给定子数组的 多数元素 。\n子数组的 多数元素 是在子数组中出现 threshold 次数或次数以上的元素。\n实现 MajorityChecker 类:\nMajorityChecker(int[] arr) 会用给定的数组 arr 对 MajorityChecker 初始化。\nint query(int left, int right, int threshold) 返回子数组中的元素 arr[left…right] 至少出现 threshold 次数，如果不存在这样的元素则返回 -1。\n题解 线段树\u002b摩尔投票 #![allow(dead_code, unused_imports, unused_macros)] use std::cmp::*; use std::collections::*; use std::f32::consts::E; use std::ops::AddAssign; use std::ops::Bound::*; #[cfg(feature = \u0026#34;local\u0026#34;)] struct Solution; macro_rules! hashmap { ($( $key: expr =\u0026gt; $val: expr ),*) =\u0026gt; {{ let mut map = ::std::collections::HashMap::new(); $( map.insert($key, $val); )* map }} } #[derive(Clone, Copy)] pub struct Node { num: i32, cnt: i32, } impl Node { #[inline] fn new(num: i32, cnt: i32) -\u0026gt; Self { Node { num, cnt } } } impl AddAssign for Node { fn add_assign(\u0026amp;mut self, rhs: Self) { if self.num == rhs.num { self.cnt \u002b= rhs.cnt; } else if self.cnt \u0026gt;= rhs.cnt { self.cnt -= rhs.cnt; } else { self.num = rhs.num; self.cnt = rhs.cnt - self.cnt; } } } pub struct SegTree { tree: Vec\u0026lt;Node\u0026gt;, val: Vec\u0026lt;i32\u0026gt;, len: usize, } impl SegTree { #[inline] pub fn new(arr: Vec\u0026lt;i32\u0026gt;) -\u0026gt; Self { let len = arr.len(); SegTree { tree: vec![Node::new(0, 0); len * 4 \u002b 1], val: arr, len, } } pub fn build(\u0026amp;mut self, id: usize, l: usize, r: usize) { if l == r { self.tree[id].num = self.val[l]; self.tree[id].cnt = 1; return; } let mid = (l \u002b r) \/ 2; self.build(id * 2 \u002b 1, l, mid); self.build(id * 2 \u002b 2, mid \u002b 1, r); let temp = self.tree[id * 2 \u002b 1]; self.tree[id] \u002b= temp; let temp = self.tree[id * 2 \u002b 2]; self.tree[id] \u002b= temp; } pub fn query(\u0026amp;self, id: usize, l: usize, r: usize, ql: usize, qr: usize, ans: \u0026amp;mut Node) { if l \u0026gt; qr || r \u0026lt; ql { return; } if ql \u0026lt;= l \u0026amp;\u0026amp; r \u0026lt;= qr { *ans \u002b= self.tree[id]; return; } let mid = (l \u002b r) \/ 2; self.query(id * 2 \u002b 1, l, mid, ql, qr, ans); self.query(id * 2 \u002b 2, mid \u002b 1, r, ql, qr, ans); } } struct MajorityChecker { seg_tree: SegTree, loc: HashMap\u0026lt;i32, Vec\u0026lt;usize\u0026gt;\u0026gt;, } \/** * \u0060\u0026amp;self\u0060 means the method takes an immutable reference. * If you need a mutable reference, change it to \u0060\u0026amp;mut self\u0060 instead. *\/ impl MajorityChecker { fn new(arr: Vec\u0026lt;i32\u0026gt;) -\u0026gt; Self { let mut loc = HashMap::new(); for (i, v) in arr.iter().enumerate() { loc.entry(*v).or_insert(vec![]).push(i); } let mut seg_tree = SegTree::new(arr); seg_tree.build(0, 0, seg_tree.len - 1); MajorityChecker { seg_tree, loc } } fn query(\u0026amp;self, left: i32, right: i32, threshold: i32) -\u0026gt; i32 { let mut ans = Node::new(0, 0); self.seg_tree.query( 0, 0, self.seg_tree.len - 1, left as usize, right as usize, \u0026amp;mut ans, ); let key = self.loc.get(\u0026amp;ans.num); if key.is_none() { return -1; } let key = key.unwrap(); let cnt = key.partition_point(|x| *x \u0026lt;= right as usize) - key.partition_point(|x| *x \u0026lt; left as usize); if cnt \u0026gt;= threshold as usize { ans.num } else { -1 } } } \/** * Your MajorityChecker object will be instantiated and called as such: * let obj = MajorityChecker::new(arr); * let ret_1: i32 = obj.query(left, right, threshold); *\/ #[cfg(feature = \u0026#34;local\u0026#34;)] pub fn main() { let arr = [1, 1, 2, 2, 1, 1]; let obj = MajorityChecker::new(arr.into()); let ini = [[0, 5, 4], [0, 3, 3], [2, 3, 2]]; for x in ini { println!(\u0026#34;res:{}\u0026#34;, obj.query(x[0], x[1], x[2])); } } 树套树 ","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2023","datePublished":"2023-04-16 14:41:57 \u002b0000 UTC","dateModified":"2023-04-16 14:41:57 \u002b0000 UTC","url":"https:\/\/booiris.space\/wiki\/leetcode\/1157-online-majority-element-in-subarray\/","keywords":["线段树","树套树","摩尔投票"]}</script><title>1157-Online Majority Element In Subarray</title><meta property="og:title" content="1157-Online Majority Element In Subarray"><meta property="og:type" content="article"><meta property="og:description" content='题意 设计一个数据结构，有效地找到给定子数组的 多数元素 。
子数组的 多数元素 是在子数组中出现 threshold 次数或次数以上的元素。
实现 MajorityChecker 类:
MajorityChecker(int[] arr) 会用给定的数组 arr 对 MajorityChecker 初始化。
int query(int left, int right, int threshold) 返回子数组中的元素 arr[left…right] 至少出现 threshold 次数，如果不存在这样的元素则返回 -1。
题解 线段树+摩尔投票 #![allow(dead_code, unused_imports, unused_macros)] use std::cmp::*; use std::collections::*; use std::f32::consts::E; use std::ops::AddAssign; use std::ops::Bound::*; #[cfg(feature = "local")] struct Solution; macro_rules! hashmap { ($( $key: expr => $val: expr ),*) => {{ let mut map = ::std::collections::HashMap::new(); $( map.insert($key, $val); )* map }} } #[derive(Clone, Copy)] pub struct Node { num: i32, cnt: i32, } impl Node { #[inline] fn new(num: i32, cnt: i32) -> Self { Node { num, cnt } } } impl AddAssign for Node { fn add_assign(&amp;mut self, rhs: Self) { if self.num == rhs.num { self.cnt += rhs.cnt; } else if self.cnt >= rhs.cnt { self.cnt -= rhs.cnt; } else { self.num = rhs.num; self.cnt = rhs.cnt - self.cnt; } } } pub struct SegTree { tree: Vec<Node>, val: Vec<i32>, len: usize, } impl SegTree { #[inline] pub fn new(arr: Vec<i32>) -> Self { let len = arr.len(); SegTree { tree: vec![Node::new(0, 0); len * 4 + 1], val: arr, len, } } pub fn build(&amp;mut self, id: usize, l: usize, r: usize) { if l == r { self.tree[id].num = self.val[l]; self.tree[id].cnt = 1; return; } let mid = (l + r) / 2; self.build(id * 2 + 1, l, mid); self.build(id * 2 + 2, mid + 1, r); let temp = self.tree[id * 2 + 1]; self.tree[id] += temp; let temp = self.tree[id * 2 + 2]; self.tree[id] += temp; } pub fn query(&amp;self, id: usize, l: usize, r: usize, ql: usize, qr: usize, ans: &amp;mut Node) { if l > qr || r < ql { return; } if ql <= l && r <= qr { *ans += self.tree[id]; return; } let mid = (l + r) / 2; self.query(id * 2 + 1, l, mid, ql, qr, ans); self.query(id * 2 + 2, mid + 1, r, ql, qr, ans); } } struct MajorityChecker { seg_tree: SegTree, loc: HashMap<i32, Vec<usize>>, } /** * `&amp;self` means the method takes an immutable reference. * If you need a mutable reference, change it to `&amp;mut self` instead. */ impl MajorityChecker { fn new(arr: Vec<i32>) -> Self { let mut loc = HashMap::new(); for (i, v) in arr.iter().enumerate() { loc.entry(*v).or_insert(vec![]).push(i); } let mut seg_tree = SegTree::new(arr); seg_tree.build(0, 0, seg_tree.len - 1); MajorityChecker { seg_tree, loc } } fn query(&amp;self, left: i32, right: i32, threshold: i32) -> i32 { let mut ans = Node::new(0, 0); self.seg_tree.query( 0, 0, self.seg_tree.len - 1, left as usize, right as usize, &amp;mut ans, ); let key = self.loc.get(&amp;ans.num); if key.is_none() { return -1; } let key = key.unwrap(); let cnt = key.partition_point(|x| *x <= right as usize) - key.partition_point(|x| *x < left as usize); if cnt >= threshold as usize { ans.num } else { -1 } } } /** * Your MajorityChecker object will be instantiated and called as such: * let obj = MajorityChecker::new(arr); * let ret_1: i32 = obj.query(left, right, threshold); */ #[cfg(feature = "local")] pub fn main() { let arr = [1, 1, 2, 2, 1, 1]; let obj = MajorityChecker::new(arr.into()); let ini = [[0, 5, 4], [0, 3, 3], [2, 3, 2]]; for x in ini { println!("res:{}", obj.query(x[0], x[1], x[2])); } } 树套树 '><meta name=description content='题意 设计一个数据结构，有效地找到给定子数组的 多数元素 。
子数组的 多数元素 是在子数组中出现 threshold 次数或次数以上的元素。
实现 MajorityChecker 类:
MajorityChecker(int[] arr) 会用给定的数组 arr 对 MajorityChecker 初始化。
int query(int left, int right, int threshold) 返回子数组中的元素 arr[left…right] 至少出现 threshold 次数，如果不存在这样的元素则返回 -1。
题解 线段树+摩尔投票 #![allow(dead_code, unused_imports, unused_macros)] use std::cmp::*; use std::collections::*; use std::f32::consts::E; use std::ops::AddAssign; use std::ops::Bound::*; #[cfg(feature = "local")] struct Solution; macro_rules! hashmap { ($( $key: expr => $val: expr ),*) => {{ let mut map = ::std::collections::HashMap::new(); $( map.insert($key, $val); )* map }} } #[derive(Clone, Copy)] pub struct Node { num: i32, cnt: i32, } impl Node { #[inline] fn new(num: i32, cnt: i32) -> Self { Node { num, cnt } } } impl AddAssign for Node { fn add_assign(&amp;mut self, rhs: Self) { if self.num == rhs.num { self.cnt += rhs.cnt; } else if self.cnt >= rhs.cnt { self.cnt -= rhs.cnt; } else { self.num = rhs.num; self.cnt = rhs.cnt - self.cnt; } } } pub struct SegTree { tree: Vec<Node>, val: Vec<i32>, len: usize, } impl SegTree { #[inline] pub fn new(arr: Vec<i32>) -> Self { let len = arr.len(); SegTree { tree: vec![Node::new(0, 0); len * 4 + 1], val: arr, len, } } pub fn build(&amp;mut self, id: usize, l: usize, r: usize) { if l == r { self.tree[id].num = self.val[l]; self.tree[id].cnt = 1; return; } let mid = (l + r) / 2; self.build(id * 2 + 1, l, mid); self.build(id * 2 + 2, mid + 1, r); let temp = self.tree[id * 2 + 1]; self.tree[id] += temp; let temp = self.tree[id * 2 + 2]; self.tree[id] += temp; } pub fn query(&amp;self, id: usize, l: usize, r: usize, ql: usize, qr: usize, ans: &amp;mut Node) { if l > qr || r < ql { return; } if ql <= l && r <= qr { *ans += self.tree[id]; return; } let mid = (l + r) / 2; self.query(id * 2 + 1, l, mid, ql, qr, ans); self.query(id * 2 + 2, mid + 1, r, ql, qr, ans); } } struct MajorityChecker { seg_tree: SegTree, loc: HashMap<i32, Vec<usize>>, } /** * `&amp;self` means the method takes an immutable reference. * If you need a mutable reference, change it to `&amp;mut self` instead. */ impl MajorityChecker { fn new(arr: Vec<i32>) -> Self { let mut loc = HashMap::new(); for (i, v) in arr.iter().enumerate() { loc.entry(*v).or_insert(vec![]).push(i); } let mut seg_tree = SegTree::new(arr); seg_tree.build(0, 0, seg_tree.len - 1); MajorityChecker { seg_tree, loc } } fn query(&amp;self, left: i32, right: i32, threshold: i32) -> i32 { let mut ans = Node::new(0, 0); self.seg_tree.query( 0, 0, self.seg_tree.len - 1, left as usize, right as usize, &amp;mut ans, ); let key = self.loc.get(&amp;ans.num); if key.is_none() { return -1; } let key = key.unwrap(); let cnt = key.partition_point(|x| *x <= right as usize) - key.partition_point(|x| *x < left as usize); if cnt >= threshold as usize { ans.num } else { -1 } } } /** * Your MajorityChecker object will be instantiated and called as such: * let obj = MajorityChecker::new(arr); * let ret_1: i32 = obj.query(left, right, threshold); */ #[cfg(feature = "local")] pub fn main() { let arr = [1, 1, 2, 2, 1, 1]; let obj = MajorityChecker::new(arr.into()); let ini = [[0, 5, 4], [0, 3, 3], [2, 3, 2]]; for x in ini { println!("res:{}", obj.query(x[0], x[1], x[2])); } } 树套树 '><meta property="og:locale" content="cn"><meta property="og:image" content="/avatar.svg"><link rel=stylesheet href=/css/index.min.css><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.min.css><link href=/%20index.xml rel=alternate type=application/rss+xml title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css></head><body><article class="post 简体中文" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>HELLO WORLD</a></div><div class=header-subtitle>Live long and prosper.</div></header><div class="row end-md header-items"><div class=header-item><a href=/about>About</a></div><div class=header-item><a href=https://github.com/booiris>Github</a></div><div class=header-item><a href=/memos>Memos</a></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>1157-Online Majority Element In Subarray</h1></header><div class="post-content markdown-body"><h2 id=题意>题意</h2><p>设计一个数据结构，有效地找到给定子数组的 <strong>多数元素</strong> 。</p><p>子数组的 <strong>多数元素</strong> 是在子数组中出现 <code>threshold</code> 次数或次数以上的元素。</p><p>实现 <code>MajorityChecker</code> 类:</p><ul><li><p><code>MajorityChecker(int[] arr)</code> 会用给定的数组 <code>arr</code> 对 <code>MajorityChecker</code> 初始化。</p></li><li><p><code>int query(int left, int right, int threshold)</code> 返回子数组中的元素  <code>arr[left…right]</code> 至少出现 <code>threshold</code> 次数，如果不存在这样的元素则返回 <code>-1</code>。</p></li></ul><h2 id=题解>题解</h2><ol><li>线段树+摩尔投票</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#57606a>#![allow(dead_code, unused_imports, unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>use</span><span style=color:#fff> </span>std::cmp::<span style=color:#0550ae>*</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>use</span><span style=color:#fff> </span>std::collections::<span style=color:#0550ae>*</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>use</span><span style=color:#fff> </span>std::<span style=color:#cf222e>f32</span>::consts::E<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>use</span><span style=color:#fff> </span>std::ops::AddAssign<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>use</span><span style=color:#fff> </span>std::ops::Bound::<span style=color:#0550ae>*</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[cfg(feature = </span><span style=color:#0a3069>&#34;local&#34;</span><span style=color:#57606a>)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>Solution</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>hashmap<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$(</span><span style=color:#fff> </span><span style=color:#57606a>$key</span>: <span style=color:#1f2328>expr</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#57606a>$val</span>: <span style=color:#1f2328>expr</span><span style=color:#fff> </span><span style=color:#1f2328>),</span><span style=color:#0550ae>*</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>         </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>map<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>::std::collections::HashMap::new<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>         </span><span style=color:#57606a>$(</span><span style=color:#fff> </span>map<span style=color:#1f2328>.</span>insert<span style=color:#1f2328>(</span><span style=color:#57606a>$key</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$val</span><span style=color:#1f2328>);</span><span style=color:#fff> </span><span style=color:#1f2328>)</span><span style=color:#0550ae>*</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>         </span>map<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[derive(Clone, Copy)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>Node</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>num: <span style=color:#cf222e>i32</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>cnt: <span style=color:#cf222e>i32</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>Node<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#57606a>#[inline]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>new</span><span style=color:#1f2328>(</span>num: <span style=color:#cf222e>i32</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>cnt: <span style=color:#cf222e>i32</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>Node<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span>num<span style=color:#1f2328>,</span><span style=color:#fff> </span>cnt<span style=color:#fff> </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>AddAssign<span style=color:#fff> </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>Node<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>add_assign</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>rhs: <span style=color:#1f2328>Self</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>num<span style=color:#fff> </span><span style=color:#0550ae>==</span><span style=color:#fff> </span>rhs<span style=color:#1f2328>.</span>num<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>cnt<span style=color:#fff> </span><span style=color:#0550ae>+=</span><span style=color:#fff> </span>rhs<span style=color:#1f2328>.</span>cnt<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>cnt<span style=color:#fff> </span><span style=color:#0550ae>&gt;=</span><span style=color:#fff> </span>rhs<span style=color:#1f2328>.</span>cnt<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>cnt<span style=color:#fff> </span><span style=color:#0550ae>-=</span><span style=color:#fff> </span>rhs<span style=color:#1f2328>.</span>cnt<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>num<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>rhs<span style=color:#1f2328>.</span>num<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>cnt<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>rhs<span style=color:#1f2328>.</span>cnt<span style=color:#fff> </span><span style=color:#0550ae>-</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>cnt<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>SegTree</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>tree: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span>Node<span style=color:#0550ae>&gt;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>val: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>i32</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>len: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>SegTree<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#57606a>#[inline]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>new</span><span style=color:#1f2328>(</span>arr: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>i32</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>len<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>arr<span style=color:#1f2328>.</span>len<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>SegTree<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>tree: <span style=color:#1f2328>vec</span><span style=color:#0550ae>!</span><span style=color:#1f2328>[</span>Node::new<span style=color:#1f2328>(</span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>);</span><span style=color:#fff> </span>len<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>],</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>val: <span style=color:#1f2328>arr</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>len<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>build</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>id: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>l: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>r: <span style=color:#cf222e>usize</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>if</span><span style=color:#fff> </span>l<span style=color:#fff> </span><span style=color:#0550ae>==</span><span style=color:#fff> </span>r<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#1f2328>].</span>num<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>val<span style=color:#1f2328>[</span>l<span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#1f2328>].</span>cnt<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>return</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>mid<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>l<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span>r<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>/</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>build<span style=color:#1f2328>(</span>id<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>l<span style=color:#1f2328>,</span><span style=color:#fff> </span>mid<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>build<span style=color:#1f2328>(</span>id<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>mid<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>r<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>temp<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>+=</span><span style=color:#fff> </span>temp<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>temp<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>+=</span><span style=color:#fff> </span>temp<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>query</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>id: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>l: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>r: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>ql: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>qr: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>ans: <span style=color:#cf222e>&amp;</span><span style=color:#1f2328>mut</span><span style=color:#fff> </span>Node<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>if</span><span style=color:#fff> </span>l<span style=color:#fff> </span><span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>qr<span style=color:#fff> </span><span style=color:#0550ae>||</span><span style=color:#fff> </span>r<span style=color:#fff> </span><span style=color:#0550ae>&lt;</span><span style=color:#fff> </span>ql<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>return</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>if</span><span style=color:#fff> </span>ql<span style=color:#fff> </span><span style=color:#0550ae>&lt;=</span><span style=color:#fff> </span>l<span style=color:#fff> </span><span style=color:#0550ae>&amp;&amp;</span><span style=color:#fff> </span>r<span style=color:#fff> </span><span style=color:#0550ae>&lt;=</span><span style=color:#fff> </span>qr<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>*</span>ans<span style=color:#fff> </span><span style=color:#0550ae>+=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>tree<span style=color:#1f2328>[</span>id<span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>return</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>mid<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>l<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span>r<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>/</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>query<span style=color:#1f2328>(</span>id<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>l<span style=color:#1f2328>,</span><span style=color:#fff> </span>mid<span style=color:#1f2328>,</span><span style=color:#fff> </span>ql<span style=color:#1f2328>,</span><span style=color:#fff> </span>qr<span style=color:#1f2328>,</span><span style=color:#fff> </span>ans<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>query<span style=color:#1f2328>(</span>id<span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>mid<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>r<span style=color:#1f2328>,</span><span style=color:#fff> </span>ql<span style=color:#1f2328>,</span><span style=color:#fff> </span>qr<span style=color:#1f2328>,</span><span style=color:#fff> </span>ans<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>MajorityChecker</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>seg_tree: <span style=color:#1f2328>SegTree</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>loc: <span style=color:#1f2328>HashMap</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>i32</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>usize</span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0a3069>/**
</span></span></span><span style=display:flex><span><span style=color:#0a3069> * `&amp;self` means the method takes an immutable reference.
</span></span></span><span style=display:flex><span><span style=color:#0a3069> * If you need a mutable reference, change it to `&amp;mut self` instead.
</span></span></span><span style=display:flex><span><span style=color:#0a3069> */</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>MajorityChecker<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>new</span><span style=color:#1f2328>(</span>arr: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>i32</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>loc<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>HashMap::new<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>for</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>i<span style=color:#1f2328>,</span><span style=color:#fff> </span>v<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#cf222e>in</span><span style=color:#fff> </span>arr<span style=color:#1f2328>.</span>iter<span style=color:#1f2328>().</span>enumerate<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>loc<span style=color:#1f2328>.</span>entry<span style=color:#1f2328>(</span><span style=color:#0550ae>*</span>v<span style=color:#1f2328>).</span>or_insert<span style=color:#1f2328>(</span><span style=color:#6639ba>vec!</span><span style=color:#1f2328>[]).</span>push<span style=color:#1f2328>(</span>i<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>seg_tree<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>SegTree::new<span style=color:#1f2328>(</span>arr<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>seg_tree<span style=color:#1f2328>.</span>build<span style=color:#1f2328>(</span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>seg_tree<span style=color:#1f2328>.</span>len<span style=color:#fff> </span><span style=color:#0550ae>-</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>MajorityChecker<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span>seg_tree<span style=color:#1f2328>,</span><span style=color:#fff> </span>loc<span style=color:#fff> </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>query</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>left: <span style=color:#cf222e>i32</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>right: <span style=color:#cf222e>i32</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>threshold: <span style=color:#cf222e>i32</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#cf222e>i32</span> <span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>ans<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>Node::new<span style=color:#1f2328>(</span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>seg_tree<span style=color:#1f2328>.</span>query<span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>seg_tree<span style=color:#1f2328>.</span>len<span style=color:#fff> </span><span style=color:#0550ae>-</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>left<span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>right<span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>ans<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>key<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>loc<span style=color:#1f2328>.</span>get<span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span>ans<span style=color:#1f2328>.</span>num<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>if</span><span style=color:#fff> </span>key<span style=color:#1f2328>.</span>is_none<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#0550ae>-</span><span style=color:#0550ae>1</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>key<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>key<span style=color:#1f2328>.</span>unwrap<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>cnt<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>key<span style=color:#1f2328>.</span>partition_point<span style=color:#1f2328>(</span><span style=color:#0550ae>|</span>x<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#0550ae>*</span>x<span style=color:#fff> </span><span style=color:#0550ae>&lt;=</span><span style=color:#fff> </span>right<span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>usize</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>-</span><span style=color:#fff> </span>key<span style=color:#1f2328>.</span>partition_point<span style=color:#1f2328>(</span><span style=color:#0550ae>|</span>x<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#0550ae>*</span>x<span style=color:#fff> </span><span style=color:#0550ae>&lt;</span><span style=color:#fff> </span>left<span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>usize</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>if</span><span style=color:#fff> </span>cnt<span style=color:#fff> </span><span style=color:#0550ae>&gt;=</span><span style=color:#fff> </span>threshold<span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>usize</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>ans<span style=color:#1f2328>.</span>num<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>-</span><span style=color:#0550ae>1</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0a3069>/**
</span></span></span><span style=display:flex><span><span style=color:#0a3069> * Your MajorityChecker object will be instantiated and called as such:
</span></span></span><span style=display:flex><span><span style=color:#0a3069> * let obj = MajorityChecker::new(arr);
</span></span></span><span style=display:flex><span><span style=color:#0a3069> * let ret_1: i32 = obj.query(left, right, threshold);
</span></span></span><span style=display:flex><span><span style=color:#0a3069> */</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[cfg(feature = </span><span style=color:#0a3069>&#34;local&#34;</span><span style=color:#57606a>)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>main</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>arr<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>obj<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>MajorityChecker::new<span style=color:#1f2328>(</span>arr<span style=color:#1f2328>.</span>into<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>ini<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>[[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>5</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>],</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>],</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0550ae>2</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>3</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>2</span><span style=color:#1f2328>]];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>x<span style=color:#fff> </span><span style=color:#cf222e>in</span><span style=color:#fff> </span>ini<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6639ba>println!</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;res:</span><span style=color:#0a3069>{}</span><span style=color:#0a3069>&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>obj<span style=color:#1f2328>.</span>query<span style=color:#1f2328>(</span>x<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>],</span><span style=color:#fff> </span>x<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>],</span><span style=color:#fff> </span>x<span style=color:#1f2328>[</span><span style=color:#0550ae>2</span><span style=color:#1f2328>]));</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><ol start=2><li>树套树</li></ol></div><div class="row middle-xs"><div class=col-xs-12><div class=post-tags><a href=/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/>线段树</a></div><div class=post-tags><a href=/tags/%E6%A0%91%E5%A5%97%E6%A0%91/>树套树</a></div><div class=post-tags><a href=/tags/%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8/>摩尔投票</a></div></div></div><div class=site-footer></div></div></div></article><script src=/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></body></html>