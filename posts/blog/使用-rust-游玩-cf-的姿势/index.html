<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.147.7"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://booiris.space/posts/blog/%E4%BD%BF%E7%94%A8-rust-%E6%B8%B8%E7%8E%A9-cf-%E7%9A%84%E5%A7%BF%E5%8A%BF/"><link rel=canonical href=https://booiris.space/posts/blog/%E4%BD%BF%E7%94%A8-rust-%E6%B8%B8%E7%8E%A9-cf-%E7%9A%84%E5%A7%BF%E5%8A%BF/><link rel=apple-touch-icon href=/avatar.svg><link rel=icon href=/avatar.svg><link rel=shortcut href=/avatar.svg><link rel=alternate type=application/atom+xml href=https://booiris.space/index.xml title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/booiris.space\/"},"articleSection":"posts","name":"使用 rust 游玩 cf 的姿势","headline":"使用 rust 游玩 cf 的姿势","description":"cf 是什么 具体来说就是\n穿越火线是一款非常受欢迎的第一人称射击网络游戏，它也被称作\u0026quot;CrossFire\u0026quot;。它最早由韩国SmileGate公司开发，后来在中国由腾讯公司运营。这个游戏在中国有着庞大的玩家基础，在亚洲其他地区以及全球也有相当多的粉丝。\n游戏提供了多种模式，包括经典的团队对战、爆破模式、生化模式等。玩家能选择成为全球反恐精英的一员，或者加入恐怖分子阵营。在游戏中，玩家可以购买和升级各种武器装备，与队友协同作战，完成不同的任务和挑战。\nCodeforces 是一个在线编程和算法竞赛平台，广受全球程序员和算法爱好者的欢迎。它提供了一个平台，用户可以通过参加定期举办的编程比赛来提高自己的编程技能和算法知识。这些比赛通常分为几个不同的难度等级，适合从初学者到高级程序员的各个水平。\n在Codeforces上，参赛者需要在限定时间内解决一系列编程问题。这些问题覆盖了数据结构、算法、数学、字符串处理、图论等众多领域。参赛者的表现根据解决问题的速度和正确性来评分，并在全球范围内进行排名。 \u0026ndash; chatgpt 生成\n网站: Codeforces\nrust 是什么 具体来说就是\n《Rust》是一款多人生存游戏，玩家需收集资源，建造庇护所，与环境和其他玩家互动以求生存。游戏以其开放世界、真实的生存挑战和玩家之间的复杂互动闻名。\nRust是一种开源的系统编程语言，以安全性、速度和并发性为设计目标。它旨在帮助开发者构建高效、可靠的软件，同时避免常见的内存安全错误，如缓冲区溢出。Rust通过一套严格的编译时检查机制实现这些目标，而无需依赖于传统的垃圾回收机制或大量的运行时检查。\nRust的设计充分考虑了现代硬件的特性，提供了零成本抽象、安全的并发编程模型，以及对内存布局的精细控制。这些特性使Rust成为开发操作系统、游戏引擎、浏览器组件以及需要高性能和高可靠性的应用程序的理想选择。 \u0026ndash; chatgpt 生成\n网站: Rust Programming Language\n正文 rust 标准库只提供了一些基本和常用的数据结构和一套\u0026quot;抽象特性\u0026quot;(或者说规范)，所以可能需要手动造一些轮子，比如处理输入和随机数生成等等，下面将介绍对应的实现代码。\n处理输入 相较于 c\u002b\u002b 的 scanf 、cin ，rust 的标准库中缺少一种方便地从标准输入中读取并构造数据的方法，网上也存在一些讨论:\nWhy is it so difficult to get user input in Rust? - help - The Rust Programming Language Forum Why is it so painful to read user inputs in Rust 所以使用 rust 解决 codeforces 中的问题所遇到的第一个困难就是如何处理输入，所幸的是这个问题在这里有所讨论，具体的解决方法参考这个回复。根据讨论中的代码修改，笔者使用的模板代码如下:\n","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2024","datePublished":"2024-03-15 21:36:47 \u002b0000 UTC","dateModified":"2024-03-15 21:36:47 \u002b0000 UTC","url":"https:\/\/booiris.space\/posts\/blog\/%E4%BD%BF%E7%94%A8-rust-%E6%B8%B8%E7%8E%A9-cf-%E7%9A%84%E5%A7%BF%E5%8A%BF\/","keywords":[]}</script><title>使用 rust 游玩 cf 的姿势</title><meta property="og:title" content="使用 rust 游玩 cf 的姿势"><meta property="og:type" content="article"><meta property="og:description" content='cf 是什么 具体来说就是
穿越火线是一款非常受欢迎的第一人称射击网络游戏，它也被称作"CrossFire"。它最早由韩国SmileGate公司开发，后来在中国由腾讯公司运营。这个游戏在中国有着庞大的玩家基础，在亚洲其他地区以及全球也有相当多的粉丝。
游戏提供了多种模式，包括经典的团队对战、爆破模式、生化模式等。玩家能选择成为全球反恐精英的一员，或者加入恐怖分子阵营。在游戏中，玩家可以购买和升级各种武器装备，与队友协同作战，完成不同的任务和挑战。
Codeforces 是一个在线编程和算法竞赛平台，广受全球程序员和算法爱好者的欢迎。它提供了一个平台，用户可以通过参加定期举办的编程比赛来提高自己的编程技能和算法知识。这些比赛通常分为几个不同的难度等级，适合从初学者到高级程序员的各个水平。
在Codeforces上，参赛者需要在限定时间内解决一系列编程问题。这些问题覆盖了数据结构、算法、数学、字符串处理、图论等众多领域。参赛者的表现根据解决问题的速度和正确性来评分，并在全球范围内进行排名。 &ndash; chatgpt 生成
网站: Codeforces
rust 是什么 具体来说就是
《Rust》是一款多人生存游戏，玩家需收集资源，建造庇护所，与环境和其他玩家互动以求生存。游戏以其开放世界、真实的生存挑战和玩家之间的复杂互动闻名。
Rust是一种开源的系统编程语言，以安全性、速度和并发性为设计目标。它旨在帮助开发者构建高效、可靠的软件，同时避免常见的内存安全错误，如缓冲区溢出。Rust通过一套严格的编译时检查机制实现这些目标，而无需依赖于传统的垃圾回收机制或大量的运行时检查。
Rust的设计充分考虑了现代硬件的特性，提供了零成本抽象、安全的并发编程模型，以及对内存布局的精细控制。这些特性使Rust成为开发操作系统、游戏引擎、浏览器组件以及需要高性能和高可靠性的应用程序的理想选择。 &ndash; chatgpt 生成
网站: Rust Programming Language
正文 rust 标准库只提供了一些基本和常用的数据结构和一套"抽象特性"(或者说规范)，所以可能需要手动造一些轮子，比如处理输入和随机数生成等等，下面将介绍对应的实现代码。
处理输入 相较于 c++ 的 scanf 、cin ，rust 的标准库中缺少一种方便地从标准输入中读取并构造数据的方法，网上也存在一些讨论:
Why is it so difficult to get user input in Rust? - help - The Rust Programming Language Forum Why is it so painful to read user inputs in Rust 所以使用 rust 解决 codeforces 中的问题所遇到的第一个困难就是如何处理输入，所幸的是这个问题在这里有所讨论，具体的解决方法参考这个回复。根据讨论中的代码修改，笔者使用的模板代码如下:
'><meta name=description content='cf 是什么 具体来说就是
穿越火线是一款非常受欢迎的第一人称射击网络游戏，它也被称作"CrossFire"。它最早由韩国SmileGate公司开发，后来在中国由腾讯公司运营。这个游戏在中国有着庞大的玩家基础，在亚洲其他地区以及全球也有相当多的粉丝。
游戏提供了多种模式，包括经典的团队对战、爆破模式、生化模式等。玩家能选择成为全球反恐精英的一员，或者加入恐怖分子阵营。在游戏中，玩家可以购买和升级各种武器装备，与队友协同作战，完成不同的任务和挑战。
Codeforces 是一个在线编程和算法竞赛平台，广受全球程序员和算法爱好者的欢迎。它提供了一个平台，用户可以通过参加定期举办的编程比赛来提高自己的编程技能和算法知识。这些比赛通常分为几个不同的难度等级，适合从初学者到高级程序员的各个水平。
在Codeforces上，参赛者需要在限定时间内解决一系列编程问题。这些问题覆盖了数据结构、算法、数学、字符串处理、图论等众多领域。参赛者的表现根据解决问题的速度和正确性来评分，并在全球范围内进行排名。 &ndash; chatgpt 生成
网站: Codeforces
rust 是什么 具体来说就是
《Rust》是一款多人生存游戏，玩家需收集资源，建造庇护所，与环境和其他玩家互动以求生存。游戏以其开放世界、真实的生存挑战和玩家之间的复杂互动闻名。
Rust是一种开源的系统编程语言，以安全性、速度和并发性为设计目标。它旨在帮助开发者构建高效、可靠的软件，同时避免常见的内存安全错误，如缓冲区溢出。Rust通过一套严格的编译时检查机制实现这些目标，而无需依赖于传统的垃圾回收机制或大量的运行时检查。
Rust的设计充分考虑了现代硬件的特性，提供了零成本抽象、安全的并发编程模型，以及对内存布局的精细控制。这些特性使Rust成为开发操作系统、游戏引擎、浏览器组件以及需要高性能和高可靠性的应用程序的理想选择。 &ndash; chatgpt 生成
网站: Rust Programming Language
正文 rust 标准库只提供了一些基本和常用的数据结构和一套"抽象特性"(或者说规范)，所以可能需要手动造一些轮子，比如处理输入和随机数生成等等，下面将介绍对应的实现代码。
处理输入 相较于 c++ 的 scanf 、cin ，rust 的标准库中缺少一种方便地从标准输入中读取并构造数据的方法，网上也存在一些讨论:
Why is it so difficult to get user input in Rust? - help - The Rust Programming Language Forum Why is it so painful to read user inputs in Rust 所以使用 rust 解决 codeforces 中的问题所遇到的第一个困难就是如何处理输入，所幸的是这个问题在这里有所讨论，具体的解决方法参考这个回复。根据讨论中的代码修改，笔者使用的模板代码如下:
'><meta property="og:locale" content="cn"><meta property="og:image" content="/avatar.svg"><link rel=stylesheet href=/css/index.min.css><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.min.css><link href=/%20index.xml rel=alternate type=application/rss+xml title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css></head><body><article class="post 简体中文" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>HELLO WORLD</a></div><div class=header-subtitle>Live long and prosper.</div></header><div class="row end-md header-items"><div class=header-item><a href=/about target=_blank>About</a></div><div class=header-item><a href=https://github.com/booiris target=_blank>Github</a></div><div class=header-item><a href=/memos target=_blank>Memos</a></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>使用 rust 游玩 cf 的姿势</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2024-03-15 21:36:47 UTC">15 Mar 2024</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><h2 id=cf-是什么>cf 是什么</h2><p>具体来说就是</p><blockquote><p><del>穿越火线是一款非常受欢迎的第一人称射击网络游戏，它也被称作"CrossFire"。它最早由韩国SmileGate公司开发，后来在中国由腾讯公司运营。这个游戏在中国有着庞大的玩家基础，在亚洲其他地区以及全球也有相当多的粉丝。</del></p><p><del>游戏提供了多种模式，包括经典的团队对战、爆破模式、生化模式等。玩家能选择成为全球反恐精英的一员，或者加入恐怖分子阵营。在游戏中，玩家可以购买和升级各种武器装备，与队友协同作战，完成不同的任务和挑战。</del></p></blockquote><blockquote><p>Codeforces 是一个在线编程和算法竞赛平台，广受全球程序员和算法爱好者的欢迎。它提供了一个平台，用户可以通过参加定期举办的编程比赛来提高自己的编程技能和算法知识。这些比赛通常分为几个不同的难度等级，适合从初学者到高级程序员的各个水平。</p><p>在Codeforces上，参赛者需要在限定时间内解决一系列编程问题。这些问题覆盖了数据结构、算法、数学、字符串处理、图论等众多领域。参赛者的表现根据解决问题的速度和正确性来评分，并在全球范围内进行排名。 &ndash; chatgpt 生成</p></blockquote><p>网站: <a href=https://codeforces.com/>Codeforces</a></p><h2 id=rust-是什么>rust 是什么</h2><p>具体来说就是</p><blockquote><p><del>《Rust》是一款多人生存游戏，玩家需收集资源，建造庇护所，与环境和其他玩家互动以求生存。游戏以其开放世界、真实的生存挑战和玩家之间的复杂互动闻名。</del></p></blockquote><blockquote><p>Rust是一种开源的系统编程语言，以安全性、速度和并发性为设计目标。它旨在帮助开发者构建高效、可靠的软件，同时避免常见的内存安全错误，如缓冲区溢出。Rust通过一套严格的编译时检查机制实现这些目标，而无需依赖于传统的垃圾回收机制或大量的运行时检查。</p><p>Rust的设计充分考虑了现代硬件的特性，提供了零成本抽象、安全的并发编程模型，以及对内存布局的精细控制。这些特性使Rust成为开发操作系统、游戏引擎、浏览器组件以及需要高性能和高可靠性的应用程序的理想选择。 &ndash; chatgpt 生成</p></blockquote><p>网站: <a href=https://www.rust-lang.org/>Rust Programming Language</a></p><h2 id=正文>正文</h2><p>rust 标准库只提供了一些基本和常用的数据结构和一套"抽象特性"(或者说规范)，所以可能需要手动造一些轮子，比如处理输入和随机数生成等等，下面将介绍对应的实现代码。</p><h3 id=处理输入>处理输入</h3><p>相较于 c++ 的 <code>scanf</code> 、<code>cin</code> ，rust 的标准库中缺少一种方便地从标准输入中读取并构造数据的方法，网上也存在一些讨论:</p><ol><li><a href=https://users.rust-lang.org/t/why-is-it-so-difficult-to-get-user-input-in-rust/27444/11>Why is it so difficult to get user input in Rust? - help - The Rust Programming Language Forum</a></li><li><a href=https://www.reddit.com/r/rust/comments/ifpi8p/why_is_it_so_painful_to_read_user_inputs_in_rust/>Why is it so painful to read user inputs in Rust</a></li></ol><p>所以使用 rust 解决 codeforces 中的问题所遇到的第一个困难就是如何处理输入，所幸的是这个问题在<a href=https://codeforces.com/blog/entry/67391>这里</a>有所讨论，具体的解决方法参考这个<a href=https://codeforces.com/blog/entry/67391?#comment-516341>回复</a>。根据讨论中的代码修改，笔者使用的模板代码如下:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>Scanner</span><span style=color:#0550ae>&lt;</span>B<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>reader: <span style=color:#1f2328>B</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>buf_str: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>u8</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>buf_iter: <span style=color:#1f2328>std</span>::<span style=color:#cf222e>str</span>::SplitWhitespace<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;static</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#0550ae>&lt;</span>B: <span style=color:#1f2328>BufRead</span><span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>Scanner<span style=color:#0550ae>&lt;</span>B<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>new</span><span style=color:#1f2328>(</span>reader: <span style=color:#1f2328>B</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>reader<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>buf_str: <span style=color:#6639ba>Vec</span>::new<span style=color:#1f2328>(),</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>buf_iter: <span style=color:#0a3069>&#34;&#34;</span><span style=color:#1f2328>.</span>split_whitespace<span style=color:#1f2328>(),</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>sc</span><span style=color:#0550ae>&lt;</span>T: <span style=color:#1f2328>std</span>::<span style=color:#cf222e>str</span>::FromStr<span style=color:#0550ae>&gt;</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>T</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>loop</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#6639ba>Some</span><span style=color:#1f2328>(</span>token<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>buf_iter<span style=color:#1f2328>.</span>next<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>token<span style=color:#1f2328>.</span>parse<span style=color:#1f2328>().</span>ok<span style=color:#1f2328>().</span>expect<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Failed parse&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>buf_str<span style=color:#1f2328>.</span>clear<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>reader<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>.</span>read_until<span style=color:#1f2328>(</span><span style=color:#0a3069>b</span><span style=color:#0a3069>&#39;\n&#39;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>buf_str<span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>.</span>expect<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Failed read&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>buf_iter<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>slice<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>std::<span style=color:#cf222e>str</span>::from_utf8_unchecked<span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>buf_str<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span>std::mem::transmute<span style=color:#1f2328>(</span>slice<span style=color:#1f2328>.</span>split_whitespace<span style=color:#1f2328>())</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#0550ae>IN</span>: <span style=color:#0550ae>*</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>Scanner<span style=color:#0550ae>&lt;</span>StdinLock<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;static</span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>std::ptr::null_mut<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>i<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6639ba>i!</span><span style=color:#1f2328>(</span><span style=color:#cf222e>i32</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$t</span>:<span style=color:#1f2328>ty</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>IN</span><span style=color:#1f2328>).</span>sc::<span style=color:#0550ae>&lt;</span><span style=color:#57606a>$t</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>// 使用方法
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>main</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#57606a>// 需要首先初始化全局的读入器。
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#fff>    </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>IN</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6639ba>Box</span>::leak<span style=color:#1f2328>(</span><span style=color:#6639ba>Box</span>::new<span style=color:#1f2328>(</span>Scanner::new<span style=color:#1f2328>(</span>io::stdin<span style=color:#1f2328>().</span>lock<span style=color:#1f2328>())))</span><span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>Scanner<span style=color:#0550ae>&lt;</span>StdinLock<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;_</span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>	</span><span style=color:#cf222e>let</span><span style=color:#fff> </span>t<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6639ba>i!</span><span style=color:#1f2328>(</span><span style=color:#6639ba>String</span><span style=color:#1f2328>);</span><span style=color:#fff> </span><span style=color:#57606a>// 从标准输入中读入一个 string。
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#fff>	</span><span style=color:#cf222e>let</span><span style=color:#fff> </span>a<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6639ba>i!</span><span style=color:#1f2328>();</span><span style=color:#fff>    </span><span style=color:#57606a>//  默认读入的类型为 i32。
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>下面大致解释一下代码的实现，首先核心的是一个名为 <code>Scanner</code> 的结构体，其中的 <code>Reader</code> 保存了数据的来源，它是一个 trait ，可以认为是任意实现了 <code>std::io::BufRead</code> 这一"规范"的结构体。具体到本代码则为标准输入流。<code>buf_str</code> 则是用于储存从 reader 中获取的数据(每次以行为单位读取数据)。<code>buf_iter</code> 用于解析和迭代遍历行内的数据。</p><p>一个读入的过程为: 从 <code>Reader</code> 中根据换行符为分隔读取数据，保存到 <code>buf_str</code> 中，然后根据空白符做切分保存到 <code>buf_iter</code> 中，然后对每一块做解析转换成需要的格式。</p><p>在之后是一个宏，用于优化使用体验。然而一定会使用到全局变量，rust 中对于全局变量的使用较为繁琐，这里采用两种方法:</p><ol><li>使用全局裸指针，使用 <code>box::leak</code> 将读取器内存泄漏，然后将裸指针指向这块内存进行调用，不过这个需要用到 unsafe ，由于 codeforces 算法都为单线程，所以不用考虑并发问题，所以这个 unsafe 是可控的。</li><li>使用 <code>RefCell</code> 获取内部可变性。</li></ol><p>通常来说，应该是使用全局裸指针性能更好，因为 <code>RefCell</code> 会在运行期进行借用检测。但经测试两者的性能差距不明显，所以读者自行选择。</p><p><a href=https://gist.github.com/booiris/68b0def25da4d820b52a65bebe3017eb>全局读取器使用裸指针和 refcell 性能测试 · GitHub</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#57606a>// RefCell 方式的全局变量
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#6639ba>thread_local!</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#0550ae>STDIN</span>: <span style=color:#1f2328>std</span>::cell::RefCell<span style=color:#0550ae>&lt;</span>Scanner<span style=color:#0550ae>&lt;</span>StdinLock<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;static</span><span style=color:#0550ae>&gt;&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>std::cell::RefCell::new<span style=color:#1f2328>(</span>Scanner::new<span style=color:#1f2328>(</span>io::stdin<span style=color:#1f2328>().</span>lock<span style=color:#1f2328>()));</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>safe_i<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6639ba>safe_i!</span><span style=color:#1f2328>(</span><span style=color:#cf222e>i32</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$t</span>:<span style=color:#1f2328>ty</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>STDIN</span><span style=color:#1f2328>.</span>with<span style=color:#1f2328>(</span><span style=color:#0550ae>|</span>r<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>r<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>r<span style=color:#1f2328>.</span>borrow_mut<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>r<span style=color:#1f2328>.</span>sc::<span style=color:#0550ae>&lt;</span><span style=color:#57606a>$t</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>()</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>})</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><hr><p>除了上面的解决方式之外，讨论中还出现了一种<a href=https://codeforces.com/blog/entry/67391?#comment-515870>解决方式</a>，具体实现原理基本上和 c++ 的<a href=https://oi-wiki.org/contest/io/#%E8%AF%BB%E5%85%A5%E4%BC%98%E5%8C%96>快读方式</a>相似，然后通过把快读封装成 trait，给基本类型使用宏实现快读的 trait 实现数据的读入。理论上这种读取方式应该更快，请读者自行取用。</p><h3 id=处理输出>处理输出</h3><p>对于输出也需要特殊处理一下，使用普通的 <code>println!</code> 宏可能会导致输出时间过长导致超时。原因是<a href=https://doc.rust-lang.org/std/macro.println.html>每次调用 <code>println!</code> 的时候都会给标准输出上锁</a>。遇到需要许多输出的题目可能会因为频繁上锁解锁导致输出时间过长。</p><p><code>println!</code> 的注释中也提到可以使用 <code>writeln!</code> 宏进行输出。对于输出加锁导致变慢的问题可以使用缓冲区解决。将输出保存到缓冲区中，最后调用 <code>flush!</code> 将缓冲区的内容写入输出流，这样就减少了加锁解锁的时间，实现了快速输出。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#0550ae>OUT</span>: <span style=color:#0550ae>*</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>std::io::BufWriter<span style=color:#0550ae>&lt;</span>std::io::StdoutLock<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;_</span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>std::ptr::null_mut<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>w<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$fmt</span>:<span style=color:#1f2328>expr</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>unsafe</span><span style=color:#1f2328>{</span><span style=color:#fff> </span><span style=color:#6639ba>write!</span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>OUT</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;{}&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$fmt</span><span style=color:#1f2328>);}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$fmt</span>:<span style=color:#1f2328>expr</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$($args</span>:<span style=color:#1f2328>tt</span><span style=color:#1f2328>)</span><span style=color:#0550ae>*</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>unsafe</span><span style=color:#1f2328>{</span><span style=color:#fff>  </span><span style=color:#6639ba>write!</span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>OUT</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$fmt</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$($args</span><span style=color:#1f2328>)</span><span style=color:#0550ae>*</span><span style=color:#1f2328>);}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>wln<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>unsafe</span><span style=color:#1f2328>{</span><span style=color:#fff> </span><span style=color:#6639ba>writeln!</span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>OUT</span><span style=color:#1f2328>);}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$fmt</span>:<span style=color:#1f2328>expr</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>unsafe</span><span style=color:#1f2328>{</span><span style=color:#fff> </span><span style=color:#6639ba>writeln!</span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>OUT</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;{}&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$fmt</span><span style=color:#1f2328>);}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$fmt</span>:<span style=color:#1f2328>expr</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$($args</span>:<span style=color:#1f2328>tt</span><span style=color:#1f2328>)</span><span style=color:#0550ae>*</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>unsafe</span><span style=color:#1f2328>{</span><span style=color:#fff>  </span><span style=color:#6639ba>writeln!</span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>OUT</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$fmt</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#57606a>$($args</span><span style=color:#1f2328>)</span><span style=color:#0550ae>*</span><span style=color:#1f2328>);}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>flush<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>(</span><span style=color:#0550ae>*</span><span style=color:#0550ae>OUT</span><span style=color:#1f2328>).</span>flush<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>main</span><span style=color:#1f2328>(){</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>OUT</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6639ba>Box</span>::leak<span style=color:#1f2328>(</span><span style=color:#6639ba>Box</span>::new<span style=color:#1f2328>(</span>io::BufWriter::new<span style=color:#1f2328>(</span>io::stdout<span style=color:#1f2328>().</span>lock<span style=color:#1f2328>())))</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#0550ae>*</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>std::io::BufWriter<span style=color:#0550ae>&lt;</span>std::io::StdoutLock<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;_</span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>a: <span style=color:#cf222e>i32</span> <span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0550ae>1</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#6639ba>wln!</span><span style=color:#1f2328>();</span><span style=color:#fff>    </span><span style=color:#57606a>// 输出 \n
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#fff>    </span><span style=color:#6639ba>wln!</span><span style=color:#1f2328>(</span>a<span style=color:#1f2328>);</span><span style=color:#fff>  </span><span style=color:#57606a>// 输出 1\n
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#fff>    </span><span style=color:#6639ba>w!</span><span style=color:#1f2328>(</span>a<span style=color:#1f2328>);</span><span style=color:#fff>    </span><span style=color:#57606a>//  输出 1
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#fff>    </span><span style=color:#6639ba>wln!</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;test: {}&#34;</span><span style=color:#1f2328>,</span>a<span style=color:#1f2328>);</span><span style=color:#fff> </span><span style=color:#57606a>// 输出 test: 1\n 
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#fff>    </span><span style=color:#6639ba>flush!</span><span style=color:#1f2328>();</span><span style=color:#fff> </span><span style=color:#57606a>// 因为全局变量已经主动泄露，所以最后不会自动 drop ，最后需要手动调用 flush 将数据由缓冲区输入到标准输出流
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>同样的，对应输出器的全局变量也有两种写法，一种 <code>static mut</code> 的全局变量，一种是 <code>Refcell</code> ，这里作为思考题请读者自行实现。</p><h3 id=处理随机数>处理随机数</h3><p>同样的，rust 的 std 中没有随机数库，需要自己手动造一下轮子。代码来源不可考了，贴一下原始的论文吧：</p><p><a href=http://vigna.di.unimi.it/ftp/papers/ScrambledLinear.pdf>vigna.di.unimi.it/ftp/papers/ScrambledLinear.pdf</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#57606a>#[derive(Debug, Clone, PartialEq, Eq)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>Rand</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>s: <span style=color:#1f2328>[</span><span style=color:#cf222e>u64</span><span style=color:#1f2328>;</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>],</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>Rand<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>new</span><span style=color:#1f2328>(</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>state: <span style=color:#cf222e>u64</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>const</span><span style=color:#fff> </span><span style=color:#0550ae>PHI</span>: <span style=color:#cf222e>u64</span> <span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0550ae>0x9e3779b97f4a7c15</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>seed<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;</span><span style=color:#1f2328>[</span><span style=color:#cf222e>u64</span><span style=color:#1f2328>;</span><span style=color:#fff> </span><span style=color:#0550ae>4</span><span style=color:#1f2328>]</span><span style=color:#0550ae>&gt;</span>::default<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>chunk<span style=color:#fff> </span><span style=color:#cf222e>in</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>seed<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>state<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>state<span style=color:#1f2328>.</span>wrapping_add<span style=color:#1f2328>(</span><span style=color:#0550ae>PHI</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>let</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span>z<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>state<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>z<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>z<span style=color:#fff> </span><span style=color:#0550ae>^</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>z<span style=color:#fff> </span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>30</span><span style=color:#1f2328>)).</span>wrapping_mul<span style=color:#1f2328>(</span><span style=color:#0550ae>0xbf58476d1ce4e5b9</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>z<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>z<span style=color:#fff> </span><span style=color:#0550ae>^</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>z<span style=color:#fff> </span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>27</span><span style=color:#1f2328>)).</span>wrapping_mul<span style=color:#1f2328>(</span><span style=color:#0550ae>0x94d049bb133111eb</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span>z<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>z<span style=color:#fff> </span><span style=color:#0550ae>^</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>z<span style=color:#fff> </span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>31</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>*</span>chunk<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>z<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>Self</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span>s: <span style=color:#1f2328>seed</span><span style=color:#fff> </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#57606a>#[inline]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>next_u32</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#cf222e>u32</span> <span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>(</span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>next_u64<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>32</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#cf222e>as</span><span style=color:#fff> </span><span style=color:#cf222e>u32</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#57606a>#[inline]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>next_u64</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#cf222e>u64</span> <span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>result_plusplus<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>.</span>wrapping_add<span style=color:#1f2328>(</span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>3</span><span style=color:#1f2328>])</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>.</span>rotate_left<span style=color:#1f2328>(</span><span style=color:#0550ae>23</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>.</span>wrapping_add<span style=color:#1f2328>(</span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>]);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>let</span><span style=color:#fff> </span>t<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>&lt;&lt;</span><span style=color:#fff> </span><span style=color:#0550ae>17</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>2</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>^=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>3</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>^=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>1</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>^=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>2</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>^=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>3</span><span style=color:#1f2328>];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>2</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>^=</span><span style=color:#fff> </span>t<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>3</span><span style=color:#1f2328>]</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>s<span style=color:#1f2328>[</span><span style=color:#0550ae>3</span><span style=color:#1f2328>].</span>rotate_left<span style=color:#1f2328>(</span><span style=color:#0550ae>45</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>result_plusplus<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>使用随机化算法的题目不是特别多，具体使用方法请看如下示例:</p><p><a href=https://codeforces.com/contest/1310/submission/252682933>Submission #252682933 - Codeforces</a></p><h3 id=图模板>图模板</h3><p>图的表示一般为邻接表和邻接矩阵。对于邻接矩阵注意如果能用定长数组就用定长数组。而对于邻接表的数据存储可以有两种方式，一种是放在 struct 中，每次创建的时候都分配一次内存，或者将数据存储再全局变量中，动态地扩展长度。从性能测试的结果也能看出后面一种方式是更快的，由于算法题中不涉及到并发问题，所以操作全局变量是安全的，所以请尽情地使用 unsafe 吧(</p><p><a href=https://gist.github.com/booiris/cf5cc7dbec64051e62244ca9143e8a5d>图结构性能测试 · GitHub</a></p><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/rust_cf_2.svg alt></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>PathType</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>from: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>to: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>v: <span style=color:#cf222e>i64</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>fmt::Display<span style=color:#fff> </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>PathType<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>fmt</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>f: <span style=color:#cf222e>&amp;</span><span style=color:#1f2328>mut</span><span style=color:#fff> </span>fmt::Formatter<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;_</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>fmt</span>::<span style=color:#6639ba>Result</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6639ba>write!</span><span style=color:#1f2328>(</span>f<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;({}, {}, {})&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>from<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>to<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>v<span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#0550ae>PATHS</span>: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span>PathType<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6639ba>vec!</span><span style=color:#1f2328>[];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#0550ae>POINT</span>: <span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#6639ba>Vec</span><span style=color:#0550ae>&lt;</span><span style=color:#cf222e>usize</span><span style=color:#0550ae>&gt;&gt;</span><span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#6639ba>vec!</span><span style=color:#1f2328>[];</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>struct</span> <span style=color:#1f2328>Graph</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span>start_from: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(dead_code)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>Graph<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>new</span><span style=color:#1f2328>(</span>p_size: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>start_from: <span style=color:#cf222e>usize</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>Graph</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>clear<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>.</span>reserve<span style=color:#1f2328>((</span>p_size<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span>start_from<span style=color:#1f2328>).</span>saturating_sub<span style=color:#1f2328>(</span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>.</span>capacity<span style=color:#1f2328>()));</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>.</span>clear<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>.</span>resize_with<span style=color:#1f2328>(</span>p_size<span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff> </span>start_from<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>||</span><span style=color:#fff> </span><span style=color:#6639ba>vec!</span><span style=color:#1f2328>[]);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>Graph<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span>start_from<span style=color:#fff> </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>add_path</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>from: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>to: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>v: <span style=color:#cf222e>i64</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>[</span>from<span style=color:#1f2328>].</span>push<span style=color:#1f2328>(</span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>len<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>push<span style=color:#1f2328>(</span>PathType<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span>from<span style=color:#1f2328>,</span><span style=color:#fff> </span>to<span style=color:#1f2328>,</span><span style=color:#fff> </span>v<span style=color:#fff> </span><span style=color:#1f2328>});</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>add_bi_path</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#cf222e>mut</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>from: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>to: <span style=color:#cf222e>usize</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>v: <span style=color:#cf222e>i64</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>[</span>from<span style=color:#1f2328>].</span>push<span style=color:#1f2328>(</span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>len<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>push<span style=color:#1f2328>(</span>PathType<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span>from<span style=color:#1f2328>,</span><span style=color:#fff> </span>to<span style=color:#1f2328>,</span><span style=color:#fff> </span>v<span style=color:#fff> </span><span style=color:#1f2328>});</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>[</span>to<span style=color:#1f2328>].</span>push<span style=color:#1f2328>(</span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>len<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>push<span style=color:#1f2328>(</span>PathType<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span>from: <span style=color:#1f2328>to</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span>to: <span style=color:#1f2328>from</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span>v<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>});</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>pub</span><span style=color:#fff> </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>get</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>now_p: <span style=color:#cf222e>usize</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>impl</span><span style=color:#fff> </span><span style=color:#6639ba>Iterator</span><span style=color:#0550ae>&lt;</span>Item<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0550ae>&amp;</span><span style=color:#6639ba>&#39;_</span><span style=color:#fff> </span>PathType<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff> </span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>[</span>now_p<span style=color:#1f2328>].</span>iter<span style=color:#1f2328>().</span>map<span style=color:#1f2328>(</span><span style=color:#cf222e>move</span><span style=color:#fff> </span><span style=color:#0550ae>|</span>x<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#0550ae>PATHS</span><span style=color:#1f2328>.</span>get_unchecked<span style=color:#1f2328>(</span><span style=color:#0550ae>*</span>x<span style=color:#1f2328>))</span><span style=color:#fff> </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>impl</span><span style=color:#fff> </span>fmt::Display<span style=color:#fff> </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>Graph<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>fn</span> <span style=color:#6639ba>fmt</span><span style=color:#1f2328>(</span><span style=color:#0550ae>&amp;</span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>f: <span style=color:#cf222e>&amp;</span><span style=color:#1f2328>mut</span><span style=color:#fff> </span>fmt::Formatter<span style=color:#0550ae>&lt;</span><span style=color:#6639ba>&#39;_</span><span style=color:#0550ae>&gt;</span><span style=color:#1f2328>)</span><span style=color:#fff> </span>-&gt; <span style=color:#1f2328>fmt</span>::<span style=color:#6639ba>Result</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>unsafe</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>now_p<span style=color:#fff> </span><span style=color:#cf222e>in</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>start_from<span style=color:#0550ae>..</span><span style=color:#0550ae>POINT</span><span style=color:#1f2328>.</span>len<span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#6639ba>write!</span><span style=color:#1f2328>(</span>f<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;{} -- &#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>now_p<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#cf222e>for</span><span style=color:#fff> </span>path<span style=color:#fff> </span><span style=color:#cf222e>in</span><span style=color:#fff> </span><span style=color:#6a737d>self</span><span style=color:#1f2328>.</span>get<span style=color:#1f2328>(</span>now_p<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#6639ba>write!</span><span style=color:#1f2328>(</span>f<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;{} &#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>path<span style=color:#1f2328>)</span><span style=color:#0550ae>?</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#6639ba>writeln!</span><span style=color:#1f2328>(</span>f<span style=color:#1f2328>)</span><span style=color:#0550ae>?</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#6639ba>Ok</span><span style=color:#1f2328>(())</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>使用方法参见:</p><p><a href=https://codeforces.com/contest/1929/submission/252942104>Submission #252942104 - Codeforces</a></p><h3 id=柯里化>柯里化</h3><p>柯里化在算法题中使用不多，大部分作用都是为了保存局部变量，用于传递给函数(由于 rust 不鼓励使用全局变量，所以容易导致传递较多的变量)。当然这种功能也能使用闭包实现，就请读者自行取用吧。使用方法参见:</p><p><a href=https://codeforces.com/contest/1933/submission/252806831>Submission #252806831 - Codeforces</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>curry2<span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$f</span>:<span style=color:#1f2328>expr</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>|</span>a<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#cf222e>move</span><span style=color:#fff> </span><span style=color:#0550ae>|</span>b<span style=color:#0550ae>|</span><span style=color:#fff>  </span><span style=color:#57606a>$f</span><span style=color:#1f2328>(</span>a<span style=color:#1f2328>,</span><span style=color:#fff> </span>b<span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>#[allow(unused_macros)]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>macro_rules<span style=color:#0550ae>!</span><span style=color:#fff> </span>curry3<span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>(</span><span style=color:#57606a>$f</span>:<span style=color:#1f2328>expr</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#0550ae>=&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>|</span>a<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#cf222e>move</span><span style=color:#fff> </span><span style=color:#0550ae>|</span>b<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#cf222e>move</span><span style=color:#fff> </span><span style=color:#0550ae>|</span>c<span style=color:#0550ae>|</span><span style=color:#fff> </span><span style=color:#57606a>$f</span><span style=color:#1f2328>(</span>a<span style=color:#1f2328>,</span><span style=color:#fff> </span>b<span style=color:#1f2328>,</span><span style=color:#fff> </span>c<span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>};</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#57606a>// 源自 Rust 如何实现柯里化？ - Spore的回答 - 知乎
</span></span></span><span style=display:flex><span><span style=color:#57606a>// https://www.zhihu.com/question/437123518/answer/1655807344
</span></span></span></code></pre></div><p>至此，请愉快地使用 rust <del>受苦</del>玩耍吧(</p></div><div class="row middle-xs"><div class=col-xs-12><div class=post-tags><a href=/categories/blog/>blog</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer></div></div></div></article><script src=/%20js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("disqus_thread"),t=new MutationObserver(function(n){n.forEach(function(){const s=e.getElementsByTagName("iframe");if(s.length>1){const n=s[1];for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(n),t.disconnect()}})});t.observe(e,{childList:!0,subtree:!0})})</script></body></html>