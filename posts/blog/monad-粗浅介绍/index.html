<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.147.7"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://booiris.space/posts/blog/monad-%E7%B2%97%E6%B5%85%E4%BB%8B%E7%BB%8D/"><link rel=canonical href=https://booiris.space/posts/blog/monad-%E7%B2%97%E6%B5%85%E4%BB%8B%E7%BB%8D/><link rel=apple-touch-icon href=/avatar.svg><link rel=icon href=/avatar.svg><link rel=shortcut href=/avatar.svg><link rel=alternate type=application/atom+xml href=https://booiris.space/index.xml title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/booiris.space\/"},"articleSection":"posts","name":"monad ç²—æµ…ä»‹ç»","headline":"monad ç²—æµ…ä»‹ç»","description":"ä»€ä¹ˆæ˜¯ monad? monad(å•å­) æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ç§æŠ½è±¡ï¼Œæœ¬æ–‡æ—¨åœ¨å¯¹ monad çš„ç²—æµ…ä»‹ç»ï¼Œæ‰€ä»¥è·³è¿‡å…¶æ•°å­¦ä¸Šçš„å®šä¹‰å’Œç»“æ„æ€§è¯æ˜(å…¶å®æ˜¯ç›®å‰ç¬”è€…ä¹Ÿä¸å¤ªæ‡‚ğŸ¤«)ï¼Œé€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­è¯´æ˜å®ƒçš„æ¦‚å¿µå’Œä½œç”¨ã€‚\nå®šä¹‰ å°½ç®¡æ²¡æœ‰å¤ªå¤æ‚çš„æ•°å­¦æ¦‚å¿µï¼Œä½†è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå®šä¹‰è¯´æ˜ä»€ä¹ˆæ ·çš„ä¸œè¥¿æ‰èƒ½ç§°ä¹‹ä¸º monadã€‚åœ¨æ¥ä¸‹æ¥çš„è¯´æ˜ä¸­ï¼Œé™¤äº†åˆ—ä¸¾å‡ºæ•°å­¦å®šä¹‰ä»¥å¤–ï¼Œè¿˜æœ‰å…¶åœ¨ go è¯­è¨€ä¸­çš„å…·ä½“è¡¨ç°å½¢å¼ã€‚åœ¨ wiki çš„å®šä¹‰ä¸­:\nMonad (functional programming) - Wikipedia\nä¸€ä¸ª monad åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†:\nç±»å‹æ„é€ å­ M ã€‚\nåœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºä¸€ç§åä¸º M åŒ…è£¹ç€ T çš„æ³›å‹ç»“æ„ä½“ M\u0026lt;T\u0026gt;{ val: T } ç±»å‹è½¬æ¢å­ Unit :: T -\u0026gt; M Tã€‚\nåœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºç”±å€¼ T æ„é€  M çš„å‡½æ•° func Unit[T any] (val T) -\u0026gt; M\u0026lt;T\u0026gt; ç»„åˆå­ \u0026gt;\u0026gt;= or FlatMap :: M T -\u0026gt; ( T -\u0026gt; M U) -\u0026gt; M U ã€‚\n","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2023","datePublished":"2023-12-12 21:20:47 \u002b0000 UTC","dateModified":"2023-12-12 21:20:47 \u002b0000 UTC","url":"https:\/\/booiris.space\/posts\/blog\/monad-%E7%B2%97%E6%B5%85%E4%BB%8B%E7%BB%8D\/","keywords":[]}</script><title>monad ç²—æµ…ä»‹ç»</title><meta property="og:title" content="monad ç²—æµ…ä»‹ç»"><meta property="og:type" content="article"><meta property="og:description" content="ä»€ä¹ˆæ˜¯ monad? monad(å•å­) æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ç§æŠ½è±¡ï¼Œæœ¬æ–‡æ—¨åœ¨å¯¹ monad çš„ç²—æµ…ä»‹ç»ï¼Œæ‰€ä»¥è·³è¿‡å…¶æ•°å­¦ä¸Šçš„å®šä¹‰å’Œç»“æ„æ€§è¯æ˜(å…¶å®æ˜¯ç›®å‰ç¬”è€…ä¹Ÿä¸å¤ªæ‡‚ğŸ¤«)ï¼Œé€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­è¯´æ˜å®ƒçš„æ¦‚å¿µå’Œä½œç”¨ã€‚
å®šä¹‰ å°½ç®¡æ²¡æœ‰å¤ªå¤æ‚çš„æ•°å­¦æ¦‚å¿µï¼Œä½†è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå®šä¹‰è¯´æ˜ä»€ä¹ˆæ ·çš„ä¸œè¥¿æ‰èƒ½ç§°ä¹‹ä¸º monadã€‚åœ¨æ¥ä¸‹æ¥çš„è¯´æ˜ä¸­ï¼Œé™¤äº†åˆ—ä¸¾å‡ºæ•°å­¦å®šä¹‰ä»¥å¤–ï¼Œè¿˜æœ‰å…¶åœ¨ go è¯­è¨€ä¸­çš„å…·ä½“è¡¨ç°å½¢å¼ã€‚åœ¨ wiki çš„å®šä¹‰ä¸­:
Monad (functional programming) - Wikipedia
ä¸€ä¸ª monad åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†:
ç±»å‹æ„é€ å­ M ã€‚
åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºä¸€ç§åä¸º M åŒ…è£¹ç€ T çš„æ³›å‹ç»“æ„ä½“ M<T>{ val: T } ç±»å‹è½¬æ¢å­ Unit :: T -> M Tã€‚
åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºç”±å€¼ T æ„é€  M çš„å‡½æ•° func Unit[T any] (val T) -> M<T> ç»„åˆå­ >>= or FlatMap :: M T -> ( T -> M U) -> M U ã€‚
"><meta name=description content="ä»€ä¹ˆæ˜¯ monad? monad(å•å­) æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ç§æŠ½è±¡ï¼Œæœ¬æ–‡æ—¨åœ¨å¯¹ monad çš„ç²—æµ…ä»‹ç»ï¼Œæ‰€ä»¥è·³è¿‡å…¶æ•°å­¦ä¸Šçš„å®šä¹‰å’Œç»“æ„æ€§è¯æ˜(å…¶å®æ˜¯ç›®å‰ç¬”è€…ä¹Ÿä¸å¤ªæ‡‚ğŸ¤«)ï¼Œé€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­è¯´æ˜å®ƒçš„æ¦‚å¿µå’Œä½œç”¨ã€‚
å®šä¹‰ å°½ç®¡æ²¡æœ‰å¤ªå¤æ‚çš„æ•°å­¦æ¦‚å¿µï¼Œä½†è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå®šä¹‰è¯´æ˜ä»€ä¹ˆæ ·çš„ä¸œè¥¿æ‰èƒ½ç§°ä¹‹ä¸º monadã€‚åœ¨æ¥ä¸‹æ¥çš„è¯´æ˜ä¸­ï¼Œé™¤äº†åˆ—ä¸¾å‡ºæ•°å­¦å®šä¹‰ä»¥å¤–ï¼Œè¿˜æœ‰å…¶åœ¨ go è¯­è¨€ä¸­çš„å…·ä½“è¡¨ç°å½¢å¼ã€‚åœ¨ wiki çš„å®šä¹‰ä¸­:
Monad (functional programming) - Wikipedia
ä¸€ä¸ª monad åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†:
ç±»å‹æ„é€ å­ M ã€‚
åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºä¸€ç§åä¸º M åŒ…è£¹ç€ T çš„æ³›å‹ç»“æ„ä½“ M<T>{ val: T } ç±»å‹è½¬æ¢å­ Unit :: T -> M Tã€‚
åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºç”±å€¼ T æ„é€  M çš„å‡½æ•° func Unit[T any] (val T) -> M<T> ç»„åˆå­ >>= or FlatMap :: M T -> ( T -> M U) -> M U ã€‚
"><meta property="og:locale" content="cn"><meta property="og:image" content="/avatar.svg"><link rel=stylesheet href=/css/index.min.css><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.min.css><link href=/%20index.xml rel=alternate type=application/rss+xml title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css></head><body><article class="post ç®€ä½“ä¸­æ–‡" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>HELLO WORLD</a></div><div class=header-subtitle>Live long and prosper.</div></header><div class="row end-md header-items"><div class=header-item><a href=/about target=_blank>About</a></div><div class=header-item><a href=https://github.com/booiris target=_blank>Github</a></div><div class=header-item><a href=/memos target=_blank>Memos</a></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>monad ç²—æµ…ä»‹ç»</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2023-12-12 21:20:47 UTC">12 Dec 2023</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><h2 id=ä»€ä¹ˆæ˜¯-monad>ä»€ä¹ˆæ˜¯ monad?</h2><p>monad(å•å­) æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ç§æŠ½è±¡ï¼Œæœ¬æ–‡æ—¨åœ¨å¯¹ monad çš„ç²—æµ…ä»‹ç»ï¼Œæ‰€ä»¥è·³è¿‡å…¶æ•°å­¦ä¸Šçš„å®šä¹‰å’Œç»“æ„æ€§è¯æ˜(å…¶å®æ˜¯ç›®å‰ç¬”è€…ä¹Ÿä¸å¤ªæ‡‚ğŸ¤«)ï¼Œé€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­è¯´æ˜å®ƒçš„æ¦‚å¿µå’Œä½œç”¨ã€‚</p><h3 id=å®šä¹‰>å®šä¹‰</h3><p>å°½ç®¡æ²¡æœ‰å¤ªå¤æ‚çš„æ•°å­¦æ¦‚å¿µï¼Œä½†è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå®šä¹‰è¯´æ˜ä»€ä¹ˆæ ·çš„ä¸œè¥¿æ‰èƒ½ç§°ä¹‹ä¸º monadã€‚åœ¨æ¥ä¸‹æ¥çš„è¯´æ˜ä¸­ï¼Œé™¤äº†åˆ—ä¸¾å‡ºæ•°å­¦å®šä¹‰ä»¥å¤–ï¼Œè¿˜æœ‰å…¶åœ¨ go è¯­è¨€ä¸­çš„å…·ä½“è¡¨ç°å½¢å¼ã€‚åœ¨ wiki çš„å®šä¹‰ä¸­:</p><blockquote><p><a href=https://en.wikipedia.org/wiki/Monad_%28functional_programming%29#Definition>Monad (functional programming) - Wikipedia</a></p></blockquote><p>ä¸€ä¸ª monad åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†:</p><ol><li><p>ç±»å‹æ„é€ å­ <code>M</code> ã€‚</p><ul><li>åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºä¸€ç§åä¸º <code>M</code> åŒ…è£¹ç€ <code>T</code> çš„æ³›å‹ç»“æ„ä½“ <code>M&lt;T>{ val: T }</code></li></ul></li><li><p>ç±»å‹è½¬æ¢å­ <code>Unit :: T -> M T</code>ã€‚</p><ul><li>åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºç”±å€¼ <code>T</code> æ„é€  <code>M</code> çš„å‡½æ•° <code>func Unit[T any] (val T) -> M&lt;T></code></li></ul></li><li><p>ç»„åˆå­ <code>>>= or FlatMap :: M T -> ( T -> M U) -> M U</code> ã€‚</p><ul><li>åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸º <code>M&lt;T>{ val: T }</code> è¿™ä¸ªç»“æ„ä½“å…·æœ‰ä¸€ä¸ªæˆå‘˜æ–¹æ³• <code>func flatMap[T, U any] (func(T) -> M&lt;U>) -> M&lt;U></code> ï¼Œèƒ½å¤Ÿæ¥å—ä¸€ä¸ªå‡½æ•°å‚æ•°å®ç°ä» <code>M&lt;T></code> åˆ° <code>M&lt;U></code> çš„å˜æ¢ã€‚</li></ul></li></ol><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªå…·æœ‰ <code>FlatMap</code> æ–¹æ³•çš„ <strong>M</strong> ä¸ºä¸€ä¸ª Monad (è¯·æ³¨æ„ä¸æ˜¯ M&lt;\T> )ã€‚</p><h4 id=æ›´ä¸¥æ ¼çš„å®šä¹‰>æ›´ä¸¥æ ¼çš„å®šä¹‰</h4><p>ä¸€ä¸ª monad è¿˜å¿…é¡»å«æœ‰ä»¥ä¸‹ä¸‰ä¸ªçº¦æŸ:</p><ol><li><p>è½¬æ¢å­ <code>Unit</code> æ˜¯ç»„åˆå­ <code>>>=</code> çš„å·¦<a href=https://en.wikipedia.org/wiki/Identity_element>å•ä½å…ƒ</a>: <code>Unit >>= f &lt;-> f</code> ã€‚</p><ul><li>åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºï¼šå¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°ä¸º <code>F[ T, U any] (T) M U</code>, é‚£ä¹ˆ <code>Unit(x).FlatMap(f)</code> çš„æ‰§è¡Œç»“æœå’Œæ‰§è¡Œ <code>f(x)</code> ç»“æœç›¸åŒ</li></ul></li><li><p>è½¬æ¢å­ <code>Unit</code> æ˜¯ç»„åˆå­ <code>>>=</code> çš„å³<a href=https://en.wikipedia.org/wiki/Identity_element>å•ä½å…ƒ</a>: <code>f >>= Unit &lt;-> f</code></p><ul><li>åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºï¼šå¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°ä¸º <code>F[ T, U any] (T) M U</code>, <code>F(x).FlatMap(Unit)</code> çš„æ‰§è¡Œç»“æœç­‰äº <code>F(x)</code></li></ul></li><li><p>ç»„åˆå­ <code>>>=</code> æ»¡è¶³ç»“åˆå¾‹: <code>ma >>= Î»x -> (f(x) >>= Î»y -> g(y))Â &lt;->Â (ma >>= Î»x -> f(x)) >>= Î»y -> g(y)</code></p><ul><li>åœ¨ go ä¸­å¯ä»¥ç†è§£ä¸ºä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹æ‰§è¡Œç»“æœç›¸ç­‰</li></ul></li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>F</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>U</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>](</span><span style=color:#1f2328>x</span> <span style=color:#1f2328>T</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>&lt;</span><span style=color:#1f2328>U</span><span style=color:#1f2328>&gt;</span>  <span style=color:#1f2328>{</span> <span style=color:#6639ba>f</span><span style=color:#1f2328>(</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>}</span> <span style=color:#57606a>// f(x) æ˜¯å¯¹ x çš„ä¸€äº›è¡Œä¸º</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>G</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>P</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>](</span><span style=color:#1f2328>y</span> <span style=color:#1f2328>U</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>&lt;</span><span style=color:#1f2328>P</span><span style=color:#1f2328>&gt;</span> <span style=color:#1f2328>{</span> <span style=color:#6639ba>g</span><span style=color:#1f2328>(</span><span style=color:#1f2328>y</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>}</span> <span style=color:#57606a>// g(y) æ˜¯å¯¹ y çš„ä¸€äº›è¡Œä¸º</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>H</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>P</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>](</span><span style=color:#1f2328>x</span> <span style=color:#1f2328>T</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>&lt;</span><span style=color:#1f2328>P</span><span style=color:#1f2328>&gt;</span> <span style=color:#1f2328>{</span> <span style=color:#6639ba>F</span><span style=color:#1f2328>(</span><span style=color:#1f2328>x</span><span style=color:#1f2328>).</span><span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>G</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>}</span> <span style=color:#57606a>// g(f(x))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#1f2328>res1</span> <span style=color:#0550ae>:=</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>{</span><span style=color:#1f2328>val</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>x</span><span style=color:#1f2328>}.</span><span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>H</span><span style=color:#1f2328>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>F</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>U</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>](</span><span style=color:#1f2328>x</span> <span style=color:#1f2328>T</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>&lt;</span><span style=color:#1f2328>U</span><span style=color:#1f2328>&gt;</span>  <span style=color:#1f2328>{</span> <span style=color:#6639ba>f</span><span style=color:#1f2328>(</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>}</span> <span style=color:#57606a>// f(x) æ˜¯å¯¹ x çš„ä¸€äº›è¡Œä¸º</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>G</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>P</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>](</span><span style=color:#1f2328>y</span> <span style=color:#1f2328>U</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>&lt;</span><span style=color:#1f2328>P</span><span style=color:#1f2328>&gt;</span> <span style=color:#1f2328>{</span> <span style=color:#6639ba>g</span><span style=color:#1f2328>(</span><span style=color:#1f2328>y</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>}</span> <span style=color:#57606a>// g(y) æ˜¯å¯¹ y çš„ä¸€äº›è¡Œä¸º</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#1f2328>res2</span> <span style=color:#0550ae>:=</span> <span style=color:#1f2328>M</span><span style=color:#1f2328>{</span> <span style=color:#1f2328>val</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>x</span> <span style=color:#1f2328>}.</span><span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>F</span><span style=color:#1f2328>).</span><span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>G</span><span style=color:#1f2328>)</span>
</span></span></code></pre></div><h2 id=monad-æœ‰ä»€ä¹ˆç”¨>monad æœ‰ä»€ä¹ˆç”¨?</h2><p>åœ¨åˆ—ä¸¾å®Œ monad çš„å®šä¹‰åï¼Œä¸ºäº†é¿å…é™·åœ¨æŠ½è±¡çš„ä¸–ç•Œé‡Œæ— æ³•è‡ªæ‹”ï¼Œç¬”è€…åœ¨æ¥ä¸‹æ¥ä¼šå…·ä½“åˆ—ä¸¾ä¸€äº›ä¾‹å­è¯´æ˜ monad çš„ä½œç”¨ ã€‚ä»¥ç¬”è€…çš„è§‚ç‚¹æ¥è¯´ï¼Œmonad çš„ä½œç”¨å°±æ˜¯æä¾›äº†ä¸€ç§éšè—å‰¯ä½œç”¨çš„å½¢å¼ï¼Œä½¿å¾—åœ¨ç¼–å†™å¤„ç†å‡½æ•°çš„æ—¶å€™åªç”¨è€ƒè™‘é¢„æœŸçš„è¾“å…¥ï¼Œå°†å‰¯ä½œç”¨å»¶ç»­åˆ°æœ€åå¤„ç†ã€‚</p><h3 id=å¦ä¸€ä¸ªå®‡å®™çš„-go-error-monad>å¦ä¸€ä¸ªå®‡å®™çš„ go error monad</h3><h4 id=å¼•è¨€>å¼•è¨€</h4><p>åœ¨ go ç¼–ç¨‹ä¸­ï¼Œå¯èƒ½å¸¸è§å¦‚ä¸‹ä»£ç :</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#57606a>// è·å–è¦æŸ¥è¯¢çš„ID</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>GetID</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>int64</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>int64</span><span style=color:#1f2328>,</span><span style=color:#cf222e>error</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span><span style=color:#57606a>// è·å– ID å¯¹åº”çš„ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>GetInfo</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>id</span> <span style=color:#cf222e>int64</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>Info</span><span style=color:#1f2328>,</span><span style=color:#cf222e>error</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span><span style=color:#57606a>// è·å–ä¸Šä¸€ä¸ª Info ä¸­ uid å¯¹åº”çš„ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>GetUserInfo</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>Info</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>UserInfo</span><span style=color:#1f2328>,</span><span style=color:#cf222e>error</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>handle</span><span style=color:#1f2328>()</span> <span style=color:#cf222e>error</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>rawID</span> <span style=color:#0550ae>:=</span> <span style=color:#0550ae>0</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>id</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>err</span> <span style=color:#0550ae>:=</span> <span style=color:#6639ba>GetID</span><span style=color:#1f2328>(</span><span style=color:#1f2328>rawID</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>if</span> <span style=color:#1f2328>err</span> <span style=color:#0550ae>!=</span> <span style=color:#cf222e>nil</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>return</span> <span style=color:#1f2328>err</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>info</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>err</span> <span style=color:#0550ae>:=</span> <span style=color:#6639ba>GetInfo</span><span style=color:#1f2328>(</span><span style=color:#1f2328>id</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>if</span> <span style=color:#1f2328>err</span> <span style=color:#0550ae>!=</span> <span style=color:#cf222e>nil</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>return</span> <span style=color:#1f2328>err</span>
</span></span><span style=display:flex><span> 	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>userInfo</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>err</span> <span style=color:#0550ae>:=</span> <span style=color:#6639ba>GetUserInfo</span><span style=color:#1f2328>(</span><span style=color:#1f2328>info</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>if</span> <span style=color:#1f2328>err</span> <span style=color:#0550ae>!=</span> <span style=color:#cf222e>nil</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>return</span> <span style=color:#1f2328>err</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>	<span style=color:#57606a>// use userInfo ...</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° go çš„çµé­‚å‡ºç°äº†ğŸ¤—</p><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/20231224210233.png alt></p><p>å½“ç„¶ç¬”è€…å¹¶ä¸åå¯¹ go è¿™ç§ä¸¥æ ¼å¤„ç†æ¯ä¸ªå‡½æ•°è¿”å›çš„é”™è¯¯å€¼çš„æ€æƒ³ï¼Œä¸è¿‡æœ¬æ–‡æ—¢ç„¶æ˜¯æœ‰å…³ monad çš„ä»‹ç»ï¼Œè‡ªç„¶æ˜¯æƒ³ç€æ€ä¹ˆå°† monad å¥—ç”¨åˆ° go çš„é”™è¯¯å¤„ç†ä¸­ã€‚</p><h4 id=go-ç‰ˆ-monad-å¼é”™è¯¯å¤„ç†>go ç‰ˆ monad å¼é”™è¯¯å¤„ç†</h4><p>å›é¡¾ monad çš„å®šä¹‰:</p><ul><li>é¦–å…ˆ monad æ˜¯ä¸€ä¸ªç»“æ„ä½“:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>type</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>]</span> <span style=color:#cf222e>struct</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>Result</span> <span style=color:#1f2328>T</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>Err</span>  <span style=color:#cf222e>error</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ç»“æ„ä½“åŒ…å«äº†è¿”å›å€¼å’Œé”™è¯¯ã€‚</p><ul><li>ç„¶åéœ€è¦ä¸€ä¸ªç”± <code>T</code> æ„é€ æˆ <code>M T</code> çš„å‡½æ•°:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>Unit</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>result</span> <span style=color:#1f2328>T</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>return</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>]{</span>
</span></span><span style=display:flex><span>		<span style=color:#1f2328>Result</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>result</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><ul><li>æœ‰ç»„åˆå­ <code>FlatMap</code> æˆå‘˜æ–¹æ³•:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>h</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>])</span> <span style=color:#1f2328>FlatMap</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>mapFunc</span> <span style=color:#cf222e>func</span><span style=color:#1f2328>(</span><span style=color:#1f2328>T</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>)</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>if</span> <span style=color:#1f2328>h</span><span style=color:#1f2328>.</span><span style=color:#1f2328>err</span> <span style=color:#0550ae>!=</span> <span style=color:#cf222e>nil</span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>return</span> <span style=color:#1f2328>h</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>return</span> <span style=color:#6639ba>mapFunc</span><span style=color:#1f2328>(</span><span style=color:#1f2328>h</span><span style=color:#1f2328>.</span><span style=color:#1f2328>result</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>æœ‰äº†ä¸Šè¿°å®ç°åï¼Œä¹‹å‰çš„æµç¨‹å°±å¯ä»¥æ”¹å†™ä¸º:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#57606a>// è·å–è¦æŸ¥è¯¢çš„ID</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>GetID</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>int64</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#cf222e>int64</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span><span style=color:#57606a>// è·å– ID å¯¹åº”çš„ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>GetInfo</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>id</span> <span style=color:#cf222e>int64</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>Info</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span><span style=color:#57606a>// è·å–ä¸Šä¸€ä¸ª Info ä¸­ uid å¯¹åº”çš„ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>GetUserInfo</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>Info</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>ErrMonad</span><span style=color:#1f2328>[</span><span style=color:#1f2328>UserInfo</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>handle</span><span style=color:#1f2328>()</span> <span style=color:#cf222e>error</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>rawID</span> <span style=color:#0550ae>:=</span> <span style=color:#6639ba>Unit</span><span style=color:#1f2328>(</span><span style=color:#6639ba>int64</span><span style=color:#1f2328>(</span><span style=color:#0550ae>0</span><span style=color:#1f2328>))</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>res</span> <span style=color:#0550ae>:=</span> <span style=color:#1f2328>rawID</span><span style=color:#1f2328>.</span>
</span></span><span style=display:flex><span>			<span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>GetID</span><span style=color:#1f2328>).</span>
</span></span><span style=display:flex><span>			<span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>GetInfo</span><span style=color:#1f2328>).</span>
</span></span><span style=display:flex><span>			<span style=color:#6639ba>FlatMap</span><span style=color:#1f2328>(</span><span style=color:#1f2328>GetUserInfo</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>	<span style=color:#cf222e>if</span> <span style=color:#1f2328>res</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Err</span> <span style=color:#0550ae>!=</span> <span style=color:#cf222e>nil</span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>		<span style=color:#cf222e>return</span> <span style=color:#1f2328>res</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Err</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>userInfo</span> <span style=color:#1f2328>=</span> <span style=color:#1f2328>res</span><span style=color:#1f2328>.</span><span style=color:#1f2328>Result</span>
</span></span><span style=display:flex><span>	<span style=color:#57606a>// use userInfo ...</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹å‡ºç›¸è¾ƒäºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä»£ç æ›´ç®€æ´äº†ä¸€äº› (è‡³å°‘å°‘äº† <code>if err != nil { return err }</code>)ã€‚</p><p>ç„¶è€Œç†æƒ³æ˜¯ç¾å¥½çš„ï¼Œçœ‹ç€ monad å®ç°è¿™ä¹ˆç®€å•ï¼Œä¸ºå•¥ç¾¤å‹æ€»è¯´ go ä¸æ”¯æŒ monad å‘¢ã€‚å›çœ‹æœ¬èŠ‚æ ‡é¢˜ &ldquo;<strong>å¦ä¸€ä¸ªå®‡å®™</strong>çš„ go error monad&rdquo;ï¼Œéå¸¸é—æ†¾çš„æ˜¯ï¼Œç›®å‰çš„ go ä¸æ”¯æŒ<strong>æ³›å‹æ–¹æ³•å‚æ•°</strong> <a href=https://go.googlesource.com/proposal/+/master/design/43651-type-parameters.md#no-parameterized-methods>Type Parameters Proposal</a>ï¼Œ<a href=/posts/blog/%E4%B8%BA%E5%95%A5-go-%E4%B8%8D%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95/>ä¸ºå•¥ go ä¸æ”¯æŒæ³›å‹æ–¹æ³•</a>ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ä¸æ”¯æŒå…¥å‚æ˜¯ä¸€ä¸ªå¸¦æ³›å‹çš„æ–¹æ³•ï¼Œå³ä»¥ä¸‹å‡½æ•°éƒ½æ˜¯æ— æ³•å®ç°çš„:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#6639ba>goIsBest</span><span style=color:#1f2328>(</span> <span style=color:#cf222e>func</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>()</span> <span style=color:#1f2328>)</span> <span style=color:#cf222e>bool</span> <span style=color:#1f2328>{</span> <span style=color:#cf222e>return</span> <span style=color:#cf222e>false</span> <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>type</span> <span style=color:#1f2328>GGGGGG</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>]</span> <span style=color:#cf222e>struct</span><span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>GGGGGG</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>])</span> <span style=color:#6639ba>gggggggggggg</span><span style=color:#1f2328>(</span> <span style=color:#cf222e>func</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>()</span> <span style=color:#1f2328>)</span> <span style=color:#1f2328>{}</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>func</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>GGGGGG</span><span style=color:#1f2328>[</span><span style=color:#1f2328>T</span><span style=color:#1f2328>])</span> <span style=color:#1f2328>gggggggggggg</span><span style=color:#1f2328>[</span><span style=color:#1f2328>U</span> <span style=color:#cf222e>any</span><span style=color:#1f2328>]</span> <span style=color:#1f2328>()</span> <span style=color:#1f2328>{}</span>
</span></span></code></pre></div><p>æ‘†ä¸ª issue åšå‚è€ƒ(å¸Œæœ›æœªæ¥ä¼šæœ‰è§£å†³æ–¹æ³•å§):</p><p><a href=https://github.com/golang/go/issues/49085>proposal: spec: allow type parameters in methods Â· Issue #49085 Â· golang/go Â· GitHub</a></p><p>è¿™å°±å¯¼è‡´äº† <code>FlatMap</code> æ–¹æ³•æ˜¯ä¸å¯è¡Œçš„ã€‚è‡³æ­¤ï¼Œgo çš„ monad ä¹‹æ—…åˆ°æ­¤ç»“æŸã€‚</p><p>é™„ä¸€ç¯‡ç»å…¸çš„é”™è¯¯å¤„ç†æ–¹æ³• blog ( æ„Ÿè§‰å°±åƒä¸€ç§é’æ˜¥ç‰ˆçš„ monadï¼Œåœ¨æ‰€ä¸¾çš„ä¾‹å­ä¸­å­˜åœ¨ç±»å‹åªæœ‰ io.Writerï¼Œæ‰€ä»¥åªç”¨åœ¨å•ä¸ªç±»å‹é‡Œæ‰“è½¬ï¼Œçœç•¥äº†ç”± T ç±»å‹åˆ° U ç±»å‹çš„è½¬æ¢ï¼Œæ‰€ä»¥è¿™ç§å½¢å¼å¯ä»¥åœ¨ go ä¸­å®ç°:</p><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/20240118232621.png alt></p><p><a href=https://go.dev/blog/errors-are-values>Errors are values - Thttps://go.dev/blog/errors-are-valueshe Go Programming Language</a></p><p><a href=https://zhuanlan.zhihu.com/p/548515367>if err != nil å¤ªçƒ¦ï¼ŸGo åˆ›å§‹äººæ•™ä½ å¦‚ä½•å¯¹é”™è¯¯è¿›è¡Œç¼–ç¨‹ï¼ - çŸ¥ä¹</a> (<del>è¯„è®ºåŒº</del>)</p><h3 id=monad-å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±>monad å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±</h3><p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ç‚¹<del>è€</del>(ä¸æ–°åˆä¸è€)çš„ä¸œè¥¿ã€‚</p><h4 id=å¼•è¨€-1>å¼•è¨€</h4><p>å„ä½å³ä½¿æ²¡å†™è¿‡ javascriptï¼Œä¹Ÿå¯èƒ½å¬è¯´è¿‡<a href=http://callbackhell.com/>å›è°ƒåœ°ç‹±</a>è¿™ä¸ªæ¦‚å¿µï¼Œå…·ä½“æ¥è®²è¿™æ˜¯ä¸€ç§ javascript å¼‚æ­¥ç¼–ç¨‹ä¸­å‡ºç°çš„ä¸€ç§ç°è±¡ã€‚æ‹¿<a href=http://callbackhell.com/>Callback Hell</a>ä¸­çš„ä¾‹å­ä¸¾ä¾‹å§:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#1f2328>fs</span><span style=color:#1f2328>.</span><span style=color:#1f2328>readdir</span><span style=color:#1f2328>(</span><span style=color:#1f2328>source</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>function</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>err</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>files</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>err</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;Error finding files: &#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>err</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span> <span style=color:#cf222e>else</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>files</span><span style=color:#1f2328>.</span><span style=color:#1f2328>forEach</span><span style=color:#1f2328>(</span><span style=color:#cf222e>function</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>filename</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>fileIndex</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#1f2328>filename</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>gm</span><span style=color:#1f2328>(</span><span style=color:#1f2328>source</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>filename</span><span style=color:#1f2328>).</span><span style=color:#1f2328>size</span><span style=color:#1f2328>(</span><span style=color:#cf222e>function</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>err</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>values</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>        <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>err</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>          <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;Error identifying file size: &#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>err</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>        <span style=color:#1f2328>}</span> <span style=color:#cf222e>else</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>          <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#1f2328>filename</span> <span style=color:#0550ae>+</span> <span style=color:#0a3069>&#39; : &#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>values</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>          <span style=color:#1f2328>aspect</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>values</span><span style=color:#1f2328>.</span><span style=color:#1f2328>width</span> <span style=color:#0550ae>/</span> <span style=color:#1f2328>values</span><span style=color:#1f2328>.</span><span style=color:#1f2328>height</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>          <span style=color:#1f2328>widths</span><span style=color:#1f2328>.</span><span style=color:#1f2328>forEach</span><span style=color:#1f2328>(</span><span style=color:#cf222e>function</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>width</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>widthIndex</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>height</span> <span style=color:#0550ae>=</span> <span style=color:#6639ba>Math</span><span style=color:#1f2328>.</span><span style=color:#1f2328>round</span><span style=color:#1f2328>(</span><span style=color:#1f2328>width</span> <span style=color:#0550ae>/</span> <span style=color:#1f2328>aspect</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;resizing &#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>filename</span> <span style=color:#0550ae>+</span> <span style=color:#0a3069>&#39;to &#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>height</span> <span style=color:#0550ae>+</span> <span style=color:#0a3069>&#39;x&#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>height</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>            <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resize</span><span style=color:#1f2328>(</span><span style=color:#1f2328>width</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>height</span><span style=color:#1f2328>).</span><span style=color:#1f2328>write</span><span style=color:#1f2328>(</span><span style=color:#1f2328>dest</span> <span style=color:#0550ae>+</span> <span style=color:#0a3069>&#39;w&#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>width</span> <span style=color:#0550ae>+</span> <span style=color:#0a3069>&#39;_&#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>filename</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>function</span><span style=color:#1f2328>(</span><span style=color:#1f2328>err</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>              <span style=color:#cf222e>if</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>err</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;Error writing file: &#39;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>err</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span>          <span style=color:#1f2328>}.</span><span style=color:#1f2328>bind</span><span style=color:#1f2328>(</span><span style=color:#cf222e>this</span><span style=color:#1f2328>))</span>
</span></span><span style=display:flex><span>        <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç å…·ä½“ä½œç”¨å°±æ˜¯å¼‚æ­¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œ: é€šè¿‡ä¼ å…¥çš„ <code>srouce</code> è¯»å–æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨ <code>gm</code> å‡½æ•°è¿›è¡Œå›¾åƒå¤„ç†ï¼Œä¿å­˜å¤„ç†åçš„å›¾åƒåˆ°ç›®æ ‡ç›®å½•ã€‚</p><p>å¯ä»¥çœ‹åˆ°ä»£ç çš„åµŒå¥—å±‚çº§éå¸¸æ·±ï¼Œè¿™å°±æ˜¯æ—©æœŸ javascript å¼‚æ­¥ç¼–ç¨‹çš„é—®é¢˜ã€‚å¯¹äºå¼‚æ­¥å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°è¡¨æ˜åœ¨å½“å‰çŠ¶æ€ç»“æŸå (å¦‚è¯»å–æ–‡ä»¶ç»“æŸå) åº”è¯¥ç»§ç»­æ‰§è¡Œçš„åŠ¨ä½œã€‚å¯ä»¥æƒ³è±¡ä¸€æ—¦å¼‚æ­¥å¤„ç†è¿‡ç¨‹å¤šäº†ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„æ–¹æ³•ï¼Œå¿…ç„¶ä¼šå¯¼è‡´æ·±å±‚æ¬¡çš„å‡½æ•°åµŒå¥—ã€‚ä¸€èˆ¬çš„åšæ³•å°±æ˜¯å°†åµŒå¥—çš„å‡½æ•°æŠ½å‡ºæ¥ï¼Œå°†å¼‚æ­¥è°ƒç”¨æ‹†è§£åˆ°æ¯ä¸ªå‡½æ•°ä¸­ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#1f2328>main</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>a</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>b</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>c</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>)))</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>// -------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>
</span></span><span style=display:flex><span><span style=color:#1f2328>main</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#1f2328>a</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>B</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#1f2328>B</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#57606a>// do something
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>	<span style=color:#1f2328>b</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>c</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#1f2328>c</span><span style=color:#1f2328>(</span><span style=color:#1f2328>value</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>	<span style=color:#57606a>// do something
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>ä½†ä¸Šè¿°åšæ³•å¸¦æ¥çš„ä¸€ä¸ªå°é—®é¢˜æ˜¯å¦‚æœéœ€è¦äº†è§£æ•´ä¸ªè¿è¡Œçš„æµç¨‹ï¼Œéœ€è¦ä¸æ–­è·³è½¬å‡½æ•°æ‰èƒ½çŸ¥é“æ•´ä¸ªè¿è¡Œé€»è¾‘ï¼Œè€Œä¸èƒ½ç›´æ¥åœ¨ä¸€ä¸ª main å‡½æ•°ä¸­çŸ¥æ™“ã€‚</p><h4 id=å¼‚æ­¥å’Œ-monad>å¼‚æ­¥å’Œ monad</h4><p>ä¸Šè¿°é—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºå¼‚æ­¥è¿‡</p><h4 id=promise-ä»‹ç»>promise ä»‹ç»</h4><p>åœ¨ 2015 å¹´åï¼Œpromise çš„å‡ºç°ç¼“è§£äº† javascript åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­çš„é—®é¢˜ï¼Œé¦–å…ˆä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ promise:</p><ul><li>promise æ˜¯ javascript ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡ <code>Promise.resolve</code> æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸€ä¸ª promise å¯¹è±¡ã€‚</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>let</span> <span style=color:#1f2328>x</span> <span style=color:#0550ae>=</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resolve</span><span style=color:#1f2328>(</span><span style=color:#0550ae>123</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#57606a>// Promise { 123 }
</span></span></span></code></pre></div><ul><li><p>promise å†…éƒ¨æœ‰ä¸‰ç§çŠ¶æ€ <code>pending</code> ã€<code>fulfilled</code> å’Œ <code>rejected</code> ã€‚ä»–ä»¬çš„ä½œç”¨åœ¨è¿™é‡Œä¸æ·±ç©¶ï¼Œåªè¦ç²—ç•¥åœ°äº†è§£ï¼š <code>fulfilled</code> å¯ä»¥è®¤ä¸ºæ˜¯æ–¹æ³•æ‰§è¡ŒæˆåŠŸçš„çŠ¶æ€ï¼Œ<code>rejected</code> å¯ä»¥è®¤ä¸ºæ˜¯æ–¹æ³•è¿”å› error çš„çŠ¶æ€ã€‚</p></li><li><p>promise æœ‰ä¸‰ä¸ªæˆå‘˜æ–¹æ³• <code>then</code> ï¼Œ<code>catch</code> å’Œ <code>finally</code>ã€‚è¿™é‡Œåªä»‹ç» <code>then</code> å’Œ <code>catch</code> æ–¹æ³•ã€‚</p></li></ul><p><code>then</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªç±»å‹ä¸ºå‡½æ•°çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯å½“çŠ¶æ€ä¸º <code>fulfilled</code> çš„æ—¶å€™è°ƒç”¨ï¼Œå¦ä¸€ä¸ªä¸º <code>rejected</code> çš„æ—¶å€™è°ƒç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç¬”è€…å–œæ¬¢åªä¼ å‰ä¸€ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨ç¼ºçœå€¼ï¼Œå³åªæœ‰åœ¨çŠ¶æ€ä¸ºæˆåŠŸçš„æ—¶å€™æ‰æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ã€‚å…·ä½“ä»£ç ä¾‹å­å¦‚ä¸‹:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>let</span> <span style=color:#1f2328>x</span> <span style=color:#0550ae>=</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resolve</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;now&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>x</span><span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>((</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;pre: &#34;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>x</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;running 1&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resolve</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;run1&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span></code></pre></div><p>å’Œ <code>then</code> ç±»ä¼¼ï¼Œ<code>catch</code> æ–¹æ³•æ¥å—ä¸€ä¸ªç±»å‹ä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå½“çŠ¶æ€ä¸º <code>rejected</code> ä¼šè°ƒç”¨ï¼Œå…·ä½“ä»£ç ä¾‹å­å¦‚ä¸‹:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>let</span> <span style=color:#1f2328>x</span> <span style=color:#0550ae>=</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>reject</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;now&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>x</span><span style=color:#1f2328>.</span><span style=color:#cf222e>catch</span><span style=color:#1f2328>((</span><span style=color:#1f2328>reason</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;break at &#34;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>reason</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span></code></pre></div><h4 id=promise-å’Œ-monad>promise å’Œ monad</h4><p>åœ¨äº†è§£äº† promise çš„æ¦‚å¿µåï¼Œå¯ä»¥çœ‹å‡º promise éå¸¸åƒä¸€ä¸ª monadã€‚ä¸‹é¢æ¥ç‚¹è¯æ˜ï¼š</p><ul><li><p>ç±»å‹æ„é€ å­ï¼šPromise &lt; T ></p></li><li><p>ç±»å‹è½¬æ¢å­ï¼šPromise.resolve</p></li><li><p>ç»„åˆå­ï¼šPromise&lt; T >.then( (value: T) => U )</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>let</span> <span style=color:#1f2328>x</span> <span style=color:#0550ae>=</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resolve</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;now&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>x</span><span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>((</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;pre: &#34;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>x</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;run1&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resolve</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;run1&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}).</span><span style=color:#1f2328>then</span><span style=color:#1f2328>((</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;pre: &#34;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>x</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;run2&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>reject</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;run2&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}).</span><span style=color:#1f2328>then</span><span style=color:#1f2328>((</span><span style=color:#1f2328>x</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;pre: &#34;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>x</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#34;run3&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#6639ba>Promise</span><span style=color:#1f2328>.</span><span style=color:#1f2328>resolve</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;run3&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}).</span><span style=color:#cf222e>catch</span><span style=color:#1f2328>((</span><span style=color:#1f2328>reason</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>log</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;break at &#34;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>reason</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span><span style=color:#57606a>/*
</span></span></span><span style=display:flex><span><span style=color:#57606a>Promise { &#39;now&#39; }
</span></span></span><span style=display:flex><span><span style=color:#57606a>pre:  now run1
</span></span></span><span style=display:flex><span><span style=color:#57606a>pre:  run1 run2
</span></span></span><span style=display:flex><span><span style=color:#57606a>break at run2
</span></span></span><span style=display:flex><span><span style=color:#57606a>*/</span>
</span></span></code></pre></div><h2 id=æ€»ç»“>æ€»ç»“</h2><h2 id=ç›¸å…³é˜…è¯»>ç›¸å…³é˜…è¯»</h2><ul><li><p><a href=https://www.bilibili.com/video/BV17E411F7cH/>Haskell Monad_å“”å“©å“”å“©_bilibili</a></p></li><li><p><a href=https://www.adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html>Functors, Applicatives, And Monads In Pictures - adit.io</a></p></li><li><p><a href=https://zhuanlan.zhihu.com/p/579141325>å¦‚ä½•è‡ªåº•å‘ä¸Šåœ°å»ºç«‹èµ·å¯¹ Monad çš„ç†è§£ - çŸ¥ä¹</a></p></li><li><p><a href=https://www.zhihu.com/question/19635359/answer/62415213>ä»€ä¹ˆæ˜¯ Monad (Functional Programming)ï¼Ÿ - Belleveçš„å›ç­” - çŸ¥ä¹ ğŸ¤£</a></p></li><li><p><a href=https://tech.meituan.com/2022/10/13/dive-into-functional-programming-01.html>æ·±å…¥ç†è§£å‡½æ•°å¼ç¼–ç¨‹ï¼ˆä¸Šï¼‰ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p></li><li><p><a href=https://tech.meituan.com/2022/10/13/dive-into-functional-programming-02.html>æ·±å…¥ç†è§£å‡½æ•°å¼ç¼–ç¨‹ï¼ˆä¸‹ï¼‰ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p></li><li><p><a href=https://zh.wikipedia.org/wiki/Future%E4%B8%8Epromise>Futureä¸promise - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦</a></p></li></ul></div><div class="row middle-xs"><div class=col-xs-12><div class=post-tags><a href=/categories/blog/>blog</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer></div></div></div></article><script src=/%20js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("disqus_thread"),t=new MutationObserver(function(n){n.forEach(function(){const s=e.getElementsByTagName("iframe");if(s.length>1){const n=s[1];for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(n),t.disconnect()}})});t.observe(e,{childList:!0,subtree:!0})})</script></body></html>