<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.154.5"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://booiris.space/posts/blog/siphash/"><link rel=canonical href=https://booiris.space/posts/blog/siphash/><link rel=apple-touch-icon href=/avatar.svg><link rel=icon href=/avatar.svg><link rel=shortcut href=/avatar.svg><link rel=alternate type=application/atom+xml href=https://booiris.space/index.xml title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/booiris.space\/"},"articleSection":"posts","name":"SipHash","headline":"SipHash","description":" è®ºæ–‡ eprint.iacr.org\/2012\/351.pdf\nä»£ç ä½ç½® library\/core\/src\/hash\/sip.rs\nSipHash æ˜¯ä¸€ç±»é’ˆå¯¹çŸ­æ¶ˆæ¯è®¾è®¡çš„ä¼ªéšæœºå‡½æ•°æ—ï¼Œç›¸è¾ƒäºå…¶ä»–çš„å“ˆå¸Œå‡½æ•°æœ‰åœ¨çŸ­æ¶ˆæ¯ä¸Šæ€§èƒ½é«˜ã€ç”±äºéšæœºè¾“å…¥çš„å­˜åœ¨éš¾ä»¥æ„é€ å“ˆå¸Œ dos æ”»å‡»çš„ä¼˜ç‚¹ï¼Œæ˜¯ rust ã€python çš„å†…ç½®å“ˆå¸Œå‡½æ•°å®ç°ã€‚\nå®ç° å¯¹äº SipHash-c-d å‡½æ•°æ—ï¼Œè¾“å…¥ä¸ºä¸€ä¸ª 128 bit çš„ k å’Œ å¯ä¸ºç©ºçš„è¾“å…¥ mï¼Œè¾“å‡ºä¸ºä¸€ä¸ª 64 ä½é•¿åº¦çš„ SipHash-c-d(k,m)ã€‚å…¶ä¸­ c ä¸º \u0026ldquo;compression rounds\u0026rdquo; çš„æ¬¡æ•°ï¼Œ d ä¸º \u0026ldquo;finalization rounds\u0026rdquo; çš„æ¬¡æ•°ï¼Œ\u0026ldquo;compression rounds\u0026rdquo; å’Œ \u0026ldquo;finalization rounds\u0026rdquo; åœ¨ä¹‹åä¸­æœ‰è¯´æ˜å…·ä½“çš„å®ç°æ­¥éª¤ã€‚\nåˆå§‹åŒ– é¦–å…ˆä½¿ç”¨ k0ã€k1 åˆå§‹åŒ–å››ä¸ªå€¼ v0 ã€v1 ã€v2 ã€v3ï¼Œå…¶ä¸­ k0ã€k1 ä¸º è¾“å…¥ k çš„ 64 ä½çš„å°ç«¯ç¼–ç  (ä¹Ÿå°±æ˜¯ä¸¤ä¸ª u64 å€¼ k0 ã€k1 ç»„æˆäº† k )ã€‚\nå¯¹äºå…¶ä¸­çš„å¸¸é‡ï¼Œè®ºæ–‡çš„é€‰å–è§£é‡Šä¸º:\nThe initial state constant corresponds to the ASCII string \u0026ldquo;somepseudorandomlygeneratedbytes\u0026rdquo;, big-endian encoded.\n","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2023","datePublished":"2023-10-13 13:36:05 \u002b0000 UTC","dateModified":"2023-10-13 13:36:05 \u002b0000 UTC","url":"https:\/\/booiris.space\/posts\/blog\/siphash\/","keywords":["hash"]}</script><title>SipHash</title><meta property="og:title" content="SipHash"><meta property="og:type" content="article"><meta property="og:description" content=" è®ºæ–‡ eprint.iacr.org/2012/351.pdf
ä»£ç ä½ç½® library/core/src/hash/sip.rs
SipHash æ˜¯ä¸€ç±»é’ˆå¯¹çŸ­æ¶ˆæ¯è®¾è®¡çš„ä¼ªéšæœºå‡½æ•°æ—ï¼Œç›¸è¾ƒäºå…¶ä»–çš„å“ˆå¸Œå‡½æ•°æœ‰åœ¨çŸ­æ¶ˆæ¯ä¸Šæ€§èƒ½é«˜ã€ç”±äºéšæœºè¾“å…¥çš„å­˜åœ¨éš¾ä»¥æ„é€ å“ˆå¸Œ dos æ”»å‡»çš„ä¼˜ç‚¹ï¼Œæ˜¯ rust ã€python çš„å†…ç½®å“ˆå¸Œå‡½æ•°å®ç°ã€‚
å®ç° å¯¹äº SipHash-c-d å‡½æ•°æ—ï¼Œè¾“å…¥ä¸ºä¸€ä¸ª 128 bit çš„ k å’Œ å¯ä¸ºç©ºçš„è¾“å…¥ mï¼Œè¾“å‡ºä¸ºä¸€ä¸ª 64 ä½é•¿åº¦çš„ SipHash-c-d(k,m)ã€‚å…¶ä¸­ c ä¸º &ldquo;compression rounds&rdquo; çš„æ¬¡æ•°ï¼Œ d ä¸º &ldquo;finalization rounds&rdquo; çš„æ¬¡æ•°ï¼Œ&ldquo;compression rounds&rdquo; å’Œ &ldquo;finalization rounds&rdquo; åœ¨ä¹‹åä¸­æœ‰è¯´æ˜å…·ä½“çš„å®ç°æ­¥éª¤ã€‚
åˆå§‹åŒ– é¦–å…ˆä½¿ç”¨ k0ã€k1 åˆå§‹åŒ–å››ä¸ªå€¼ v0 ã€v1 ã€v2 ã€v3ï¼Œå…¶ä¸­ k0ã€k1 ä¸º è¾“å…¥ k çš„ 64 ä½çš„å°ç«¯ç¼–ç  (ä¹Ÿå°±æ˜¯ä¸¤ä¸ª u64 å€¼ k0 ã€k1 ç»„æˆäº† k )ã€‚
å¯¹äºå…¶ä¸­çš„å¸¸é‡ï¼Œè®ºæ–‡çš„é€‰å–è§£é‡Šä¸º:
The initial state constant corresponds to the ASCII string &ldquo;somepseudorandomlygeneratedbytes&rdquo;, big-endian encoded.
"><meta name=description content=" è®ºæ–‡ eprint.iacr.org/2012/351.pdf
ä»£ç ä½ç½® library/core/src/hash/sip.rs
SipHash æ˜¯ä¸€ç±»é’ˆå¯¹çŸ­æ¶ˆæ¯è®¾è®¡çš„ä¼ªéšæœºå‡½æ•°æ—ï¼Œç›¸è¾ƒäºå…¶ä»–çš„å“ˆå¸Œå‡½æ•°æœ‰åœ¨çŸ­æ¶ˆæ¯ä¸Šæ€§èƒ½é«˜ã€ç”±äºéšæœºè¾“å…¥çš„å­˜åœ¨éš¾ä»¥æ„é€ å“ˆå¸Œ dos æ”»å‡»çš„ä¼˜ç‚¹ï¼Œæ˜¯ rust ã€python çš„å†…ç½®å“ˆå¸Œå‡½æ•°å®ç°ã€‚
å®ç° å¯¹äº SipHash-c-d å‡½æ•°æ—ï¼Œè¾“å…¥ä¸ºä¸€ä¸ª 128 bit çš„ k å’Œ å¯ä¸ºç©ºçš„è¾“å…¥ mï¼Œè¾“å‡ºä¸ºä¸€ä¸ª 64 ä½é•¿åº¦çš„ SipHash-c-d(k,m)ã€‚å…¶ä¸­ c ä¸º &ldquo;compression rounds&rdquo; çš„æ¬¡æ•°ï¼Œ d ä¸º &ldquo;finalization rounds&rdquo; çš„æ¬¡æ•°ï¼Œ&ldquo;compression rounds&rdquo; å’Œ &ldquo;finalization rounds&rdquo; åœ¨ä¹‹åä¸­æœ‰è¯´æ˜å…·ä½“çš„å®ç°æ­¥éª¤ã€‚
åˆå§‹åŒ– é¦–å…ˆä½¿ç”¨ k0ã€k1 åˆå§‹åŒ–å››ä¸ªå€¼ v0 ã€v1 ã€v2 ã€v3ï¼Œå…¶ä¸­ k0ã€k1 ä¸º è¾“å…¥ k çš„ 64 ä½çš„å°ç«¯ç¼–ç  (ä¹Ÿå°±æ˜¯ä¸¤ä¸ª u64 å€¼ k0 ã€k1 ç»„æˆäº† k )ã€‚
å¯¹äºå…¶ä¸­çš„å¸¸é‡ï¼Œè®ºæ–‡çš„é€‰å–è§£é‡Šä¸º:
The initial state constant corresponds to the ASCII string &ldquo;somepseudorandomlygeneratedbytes&rdquo;, big-endian encoded.
"><meta property="og:locale" content="en-us"><meta property="og:image" content="/avatar.svg"><link rel=stylesheet href=/css/index.min.css><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.min.css><link href=/%20index.xml rel=alternate type=application/rss+xml title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css></head><body><article class="post cn" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>KEEP SEEKING</a></div><div class=header-subtitle>Live long and prosper.</div></header><div class="row end-md header-items"><div class=header-item><a href=/>Home</a></div><div class=header-item><a href=/about>About</a></div><div class=header-item><a href=https://github.com/booiris target=_blank>Github</a></div><div class=header-item><a href=/memos>Memos</a></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>SipHash</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2023-10-13 13:36:05 UTC">13 Oct 2023</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><blockquote><p>è®ºæ–‡ <a href=https://eprint.iacr.org/2012/351.pdf>eprint.iacr.org/2012/351.pdf</a></p></blockquote><blockquote><p>ä»£ç ä½ç½® <a href=https://github.com/rust-lang/rust/blob/1.72.0/library/core/src/hash/sip.rs>library/core/src/hash/sip.rs</a></p></blockquote><p>SipHash æ˜¯ä¸€ç±»é’ˆå¯¹çŸ­æ¶ˆæ¯è®¾è®¡çš„ä¼ªéšæœºå‡½æ•°æ—ï¼Œç›¸è¾ƒäºå…¶ä»–çš„å“ˆå¸Œå‡½æ•°æœ‰åœ¨çŸ­æ¶ˆæ¯ä¸Šæ€§èƒ½é«˜ã€ç”±äºéšæœºè¾“å…¥çš„å­˜åœ¨éš¾ä»¥æ„é€ <a href=../todo/todo.md>å“ˆå¸Œ dos æ”»å‡»</a>çš„ä¼˜ç‚¹ï¼Œæ˜¯ rust ã€python çš„å†…ç½®å“ˆå¸Œå‡½æ•°å®ç°ã€‚</p><h2 id=å®ç°>å®ç°</h2><p>å¯¹äº SipHash-c-d å‡½æ•°æ—ï¼Œè¾“å…¥ä¸ºä¸€ä¸ª 128 bit çš„ <code>k</code> å’Œ å¯ä¸ºç©ºçš„è¾“å…¥ <code>m</code>ï¼Œè¾“å‡ºä¸ºä¸€ä¸ª 64 ä½é•¿åº¦çš„ <code>SipHash-c-d(k,m)</code>ã€‚å…¶ä¸­ <code>c</code> ä¸º &ldquo;compression rounds&rdquo; çš„æ¬¡æ•°ï¼Œ <code>d</code> ä¸º &ldquo;finalization rounds&rdquo; çš„æ¬¡æ•°ï¼Œ&ldquo;compression rounds&rdquo; å’Œ &ldquo;finalization rounds&rdquo; åœ¨ä¹‹åä¸­æœ‰è¯´æ˜å…·ä½“çš„å®ç°æ­¥éª¤ã€‚</p><h3 id=åˆå§‹åŒ–>åˆå§‹åŒ–</h3><p>é¦–å…ˆä½¿ç”¨ <code>k0</code>ã€<code>k1</code> åˆå§‹åŒ–å››ä¸ªå€¼ <code>v0</code> ã€<code>v1</code> ã€<code>v2</code> ã€<code>v3</code>ï¼Œå…¶ä¸­ <code>k0</code>ã€<code>k1</code> ä¸º è¾“å…¥ <code>k</code> çš„ 64 ä½çš„å°ç«¯ç¼–ç  (ä¹Ÿå°±æ˜¯ä¸¤ä¸ª u64 å€¼ <code>k0</code> ã€<code>k1</code> ç»„æˆäº† <code>k</code> )ã€‚</p><p>å¯¹äºå…¶ä¸­çš„å¸¸é‡ï¼Œè®ºæ–‡çš„é€‰å–è§£é‡Šä¸º:</p><blockquote><p>The initial state constant corresponds to the ASCII string &ldquo;somepseudorandomlygeneratedbytes&rdquo;, big-endian encoded.</p></blockquote><p>è®ºæ–‡ä¸­æå‡ºåªéœ€è¦æ»¡è¶³ <code>v0</code> å’Œ <code>v1</code> ä¸åŒäº <code>v2</code> å’Œ <code>v3</code> å³å¯(ä¹Ÿæ²¡åˆ†æä¸ºå•¥ã€‚ã€‚ã€‚)ã€‚</p><blockquote><p>the only requirement was some asymmetry so that the initial v0 and v1 differ from v2 and v3.</p></blockquote><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/spihash1.png alt></p><h3 id=compression-round>Compression Round</h3><p>åœ¨åˆå§‹åŒ–çŠ¶æ€åï¼Œå°†è¾“å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œå°†è¾“å…¥çš„å­—ç¬¦ä¸²ä»¥æ¯ 8 å­—èŠ‚ä½œä¸ºä¸€ç»„ä»¥å°ç«¯åºç¼–ç æˆ 64 ä½çš„æ•° $m_i$ ï¼Œæœ€åä¸å¤Ÿçš„ç”¨ 0 åšå¡«å……ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚çš„å€¼ä¸ºè¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦ $len \bmod 256$ã€‚å…·ä½“æ¥è¯´ï¼Œç¼–ç çš„è¿‡ç¨‹å¦‚ä¸‹å›¾:</p><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/siphash_encode.png alt></p><p>åœ¨å°†è¾“å…¥ <code>s</code> ç¼–ç æˆ $m_0,m_1 \dots m_{\lceil \frac{(len+1)}{8} \rceil}$ åï¼Œå¯¹äºæ¯ä¸ª $m_i$ æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œè¿­ä»£æ‰§è¡Œå®Œæ‰€æœ‰çš„è¾“å…¥åï¼Œ<code>Compression Round</code> å®Œæˆã€‚</p><p>$$
\begin{aligned}
v_3 \ \oplus = m_i \
SipRound(v_0,v_1,v_2,v_3)\ for\ c \ times \
v_0 \ \oplus = m_i
\end{aligned}
$$</p><p>PS: å·¨ğŸ’©ğŸ¤¡çš„æ˜¯è®ºæ–‡ä¸­çš„ &ldquo;For example, the one-byte input string m = ab is parsed as m0 = 01000000000000ab&rdquo;ã€‚å¼€å§‹æˆ‘è¿˜ä»¥ä¸ºè¾“å…¥çš„æ˜¯å­—ç¬¦ä¸² &ldquo;ab&rdquo;ï¼Œæ²¡çœ‹åˆ° &ldquo;one-byte input&rdquo;ï¼Œå¯¼è‡´ç¼–ç è¾“å…¥ m è¿™å—å¡äº†ä¸€ä¼šã€‚æ„Ÿè§‰å†™æˆ &ldquo;0xab&rdquo; å’Œ &ldquo;0x01000000000000ab&rdquo; ä¼šå¥½ä¸€ç‚¹ğŸ¤¡ã€‚</p><h3 id=finalization-round>Finalization Round</h3><p>åœ¨æ‰€æœ‰çš„è¾“å…¥å­—èŠ‚å¤„ç†åœ¨ <code>Compression Round</code> å¤„ç†å®Œæˆåï¼Œå°† $v_2$ å’Œå¸¸é‡ $0\mathrm{xff}$ (ä¹Ÿæ˜¯ä¸€ä¸ªéšæœºçš„éé›¶å€¼å³å¯) è¿›è¡Œå¼‚æˆ–ï¼Œå†è¿›è¡Œ <code>d</code> è½® <code>SipRound</code> ä¹‹åï¼Œå°† $v_0$ ã€$v_1$ã€$v_2$ã€$v_3$ è¿›è¡Œå¼‚æˆ–å’Œåå¾—åˆ°æœ€ç»ˆçš„ 64 ä½å“ˆå¸Œå€¼ã€‚</p><p>$$
\begin{aligned}
v_2 \ \oplus = 0\mathrm{xff} \
SipRound(v_0,v_1,v_2,v_3)\ for\ d \ times \
res = v_0 \oplus v_1 \oplus v_2 \oplus v_3
\end{aligned}
$$</p><h3 id=sipround>SipRound</h3><p>SipRound çš„è¿ç®—è¿‡ç¨‹å¦‚ä¸‹:</p><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/siphash_sipround1.png alt></p><p><img src=https://cdn.jsdelivr.net/gh/booiris-cdn/img/spihash2.png alt></p><h2 id=å®‰å…¨æ€§åˆ†æ>å®‰å…¨æ€§åˆ†æ</h2><p>#todo</p><ul><li><input disabled type=checkbox> SipHash å®‰å…¨æ€§åˆ†æ</li></ul></div><div class="row middle-xs"><div class=col-xs-12><div class=post-tags><a href=/categories/blog/>/blog</a></div><div class=post-tags><a href=/tags/hash/>hash</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer></div></div></div></article><script src=/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></body></html>