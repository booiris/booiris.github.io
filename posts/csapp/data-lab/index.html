<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.147.7"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://booiris.space/posts/csapp/data-lab/"><link rel=canonical href=https://booiris.space/posts/csapp/data-lab/><link rel=apple-touch-icon href=/avatar.svg><link rel=icon href=/avatar.svg><link rel=shortcut href=/avatar.svg><link rel=alternate type=application/atom+xml href=https://booiris.space/index.xml title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/booiris.space\/"},"articleSection":"posts","name":"Data Lab","headline":"Data Lab","description":"CS:APP Data Lab restriction Integer constants 0 through 255 (0xFF), inclusive. You are not allowed to use big constants such as 0xffffffff. Function arguments and local variables (no global variables). Unary integer operations ! ~ Binary integer operations \u0026amp; ^ | \u002b \u0026laquo; \u0026raquo; NOT ALLOW Use any control constructs such as if, do, while, for, switch, etc. Define or use any macros. Define any additional functions in this file. Call any functions. Use any other operations, such as \u0026amp;\u0026amp;, ||, -, or ?: Use any form of casting. Use any data type other than int. This implies that you cannot use arrays, structs, or unions. Question q1 Description bitXor - x^y using only ~ and \u0026amp;.\n","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2022","datePublished":"2022-05-03 23:24:12 \u002b0000 UTC","dateModified":"2022-05-03 23:24:12 \u002b0000 UTC","url":"https:\/\/booiris.space\/posts\/csapp\/data-lab\/","keywords":[]}</script><title>Data Lab</title><meta property="og:title" content="Data Lab"><meta property="og:type" content="article"><meta property="og:description" content="CS:APP Data Lab restriction Integer constants 0 through 255 (0xFF), inclusive. You are not allowed to use big constants such as 0xffffffff. Function arguments and local variables (no global variables). Unary integer operations ! ~ Binary integer operations & ^ | + &#171; &#187; NOT ALLOW Use any control constructs such as if, do, while, for, switch, etc. Define or use any macros. Define any additional functions in this file. Call any functions. Use any other operations, such as &&, ||, -, or ?: Use any form of casting. Use any data type other than int. This implies that you cannot use arrays, structs, or unions. Question q1 Description bitXor - x^y using only ~ and &.
"><meta name=description content="CS:APP Data Lab restriction Integer constants 0 through 255 (0xFF), inclusive. You are not allowed to use big constants such as 0xffffffff. Function arguments and local variables (no global variables). Unary integer operations ! ~ Binary integer operations & ^ | + &#171; &#187; NOT ALLOW Use any control constructs such as if, do, while, for, switch, etc. Define or use any macros. Define any additional functions in this file. Call any functions. Use any other operations, such as &&, ||, -, or ?: Use any form of casting. Use any data type other than int. This implies that you cannot use arrays, structs, or unions. Question q1 Description bitXor - x^y using only ~ and &.
"><meta property="og:locale" content="cn"><meta property="og:image" content="/avatar.svg"><link rel=stylesheet href=/css/index.min.css><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.min.css><link href=/%20index.xml rel=alternate type=application/rss+xml title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css></head><body><article class="post cn" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>HELLO WORLD</a></div><div class=header-subtitle>Live long and prosper.</div></header><div class="row end-md header-items"><div class=header-item><a href=/>Home</a></div><div class=header-item><a href=/about>About</a></div><div class=header-item><a href=https://github.com/booiris target=_blank>Github</a></div><div class=header-item><a href=/memos>Memos</a></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>Data Lab</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2022-05-03 23:24:12 UTC">03 May 2022</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><h1 id=csapp-data-lab>CS:APP Data Lab</h1><h2 id=restriction>restriction</h2><ol><li>Integer constants 0 through 255 (0xFF), inclusive. You are
not allowed to use big constants such as 0xffffffff.</li><li>Function arguments and local variables (no global variables).</li><li>Unary integer operations ! ~</li><li>Binary integer operations & ^ | + &#171; &#187;</li><li>NOT ALLOW<ol><li>Use any control constructs such as if, do, while, for, switch, etc.</li><li>Define or use any macros.</li><li>Define any additional functions in this file.</li><li>Call any functions.</li><li>Use any other operations, such as &&, ||, -, or ?:</li><li>Use any form of casting.</li><li>Use any data type other than int. This implies that you
cannot use arrays, structs, or unions.</li></ol></li></ol><h2 id=question>Question</h2><h3 id=q1>q1</h3><h4 id=description>Description</h4><p>bitXor - x^y using only ~ and &.</p><h4 id=example>Example</h4><p>bitXor(4, 5) = 1</p><h4 id=answer>Answer</h4><p>$$
\begin{aligned}
x \oplus y &= (\sim x \wedge y) \vee (x \wedge \sim y) = \sim(\sim(\sim x \wedge y) \wedge \sim(x \wedge \sim y)) \
x \oplus y &= (x \vee y) \wedge (\sim x \vee \sim y) = \sim(\sim x \wedge \sim y) \wedge \sim (x \wedge y)
\end{aligned}
$$</p><p>Compare eq1 and eq2, eq1 uses five NOT operations and three AND operations, eq2 uses four NOT operations and three AND operations. Therefore eq2 is better.</p><h4 id=code>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>bitXor</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>,</span> <span style=color:#cf222e>int</span> y<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#0550ae>~</span><span style=color:#1f2328>(</span>x <span style=color:#0550ae>&amp;</span> y<span style=color:#1f2328>)</span> <span style=color:#0550ae>&amp;</span> <span style=color:#0550ae>~</span><span style=color:#1f2328>(</span><span style=color:#0550ae>~</span>x <span style=color:#0550ae>&amp;</span> <span style=color:#0550ae>~</span>y<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#57606a>// return ~(~(x &amp; ~y) &amp; ~(~x &amp; y));
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><h3 id=q2>q2</h3><h4 id=description-1>Description</h4><p>tmin - return minimum two&rsquo;s complement integer.</p><p>Legal ops: ! ~ & ^ | + &#171; &#187;.</p><h4 id=answer-1>Answer</h4><p>For data of type int, the minimum value is $-2^{31}$ which is expressed in binary as 1|0x31.</p><h4 id=code-1>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>tmin</span><span style=color:#1f2328>(</span><span style=color:#cf222e>void</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#0550ae>1</span> <span style=color:#0550ae>&lt;&lt;</span> <span style=color:#0550ae>31</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><h3 id=q3>q3</h3><h4 id=description-2>Description</h4><p>IsTmax - returns 1 if x is the maximum, two&rsquo;s complement number, and 0 otherwise.</p><p>Legal ops: ! ~ & ^ | +.</p><h4 id=answer-2>Answer</h4><p>Notice that only when x = -1 or x = INT_MAX, x^(x+1) = 0xffffffff.</p><p>Therefore, we can use a = ~(x ^ (x+1)) to find INT_MAX and -1. when a = 0, x = INT_MAX or -1.</p><p>Next step we need to distinguish INT_MAX and -1. Notice that -1 + 1 = 0. So we can use b = !(x+1) to find -1. when b = 0, x = INT_MAX; b = 1, x = -1.</p><p>At Last, we can use res = !(a | b) to check whether x is INT_MAX.</p><h4 id=code-2>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>isTmax</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> temp <span style=color:#0550ae>=</span> x <span style=color:#0550ae>+</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> a <span style=color:#0550ae>=</span> <span style=color:#0550ae>~</span><span style=color:#1f2328>(</span>x <span style=color:#0550ae>^</span> temp<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>((</span><span style=color:#0550ae>!</span>temp<span style=color:#1f2328>)</span> <span style=color:#0550ae>|</span> a<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><h3 id=q4>q4</h3><h4 id=description-3>Description</h4><p>allOddBits - return 1 if all odd-numbered bits in word set to 1 where bits are numbered from 0 (least significant) to 31 (most significant).</p><h4 id=example-1>Example</h4><p>Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1.</p><h4 id=answer-3>Answer</h4><p>We can use (x & 0xAAAAAAAA) ^ 0xAAAAAAAA to check if all odd-numbered bits in word set to 1.</p><p>Therefore it&rsquo;s important to get a constant 0xAAAAAAAA.</p><p>Since we can only use 0 ~ 0xff, we can simply repeate flowing code four times to get 0xAAAAAAAA.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span>key <span style=color:#0550ae>|=</span> <span style=color:#0550ae>0xaa</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>key <span style=color:#0550ae>&lt;&lt;=</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>;</span>
</span></span></code></pre></div><p>However, it will cost 2 * 4 = 8 operations. We can use a better way to get constant.</p><ol><li>get a = 0xAA.</li><li>get b = 0xAAAA.</li><li>get c = 0xAAAAAAAA.</li></ol><p>It&rsquo;s a bit like binary serach. Every time we can construct double length number. Therefore to build a 32 bits number, we just use $log(\frac{32}{4}) = 3$ operations to get the number.</p><h4 id=code-3>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>allOddBits</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> a <span style=color:#0550ae>=</span> <span style=color:#0550ae>0xaa</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> b <span style=color:#0550ae>=</span> a <span style=color:#0550ae>|</span> a <span style=color:#0550ae>&lt;&lt;</span> <span style=color:#0550ae>8</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> c <span style=color:#0550ae>=</span> b <span style=color:#0550ae>|</span> b <span style=color:#0550ae>&lt;&lt;</span> <span style=color:#0550ae>16</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>((</span>x <span style=color:#0550ae>&amp;</span> c<span style=color:#1f2328>)</span> <span style=color:#0550ae>^</span> c<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><h3 id=q5>q5</h3><h4 id=description-4>Description</h4><p>negate - return -x</p><h4 id=example-2>Example</h4><p>Example: negate(1) = -1.</p><h4 id=answer-4>Answer</h4><p>Since x + ~x = -1, we can change it to -x = ~x + 1.</p><h4 id=code-4>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>negate</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> <span style=color:#0550ae>~</span>x <span style=color:#0550ae>+</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><h3 id=q6>q6</h3><h4 id=description-5>Description</h4><p>isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &lsquo;0&rsquo; to &lsquo;9&rsquo;)</p><h4 id=example-3>Example</h4><p>isAsciiDigit(0x35) = 1.</p><p>isAsciiDigit(0x3a) = 0.</p><p>isAsciiDigit(0x05) = 0.</p><h4 id=answer-5>Answer</h4><p>%TODO</p><h4 id=code-5>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>isAsciiDigit</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> a <span style=color:#0550ae>=</span> x <span style=color:#0550ae>&gt;&gt;</span> <span style=color:#0550ae>4</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> key <span style=color:#0550ae>=</span> <span style=color:#0550ae>0x3</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> check1 <span style=color:#0550ae>=</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>(</span>key <span style=color:#0550ae>^</span> a<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> check2 <span style=color:#0550ae>=</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>((</span>x <span style=color:#0550ae>&gt;&gt;</span> <span style=color:#0550ae>3</span><span style=color:#1f2328>)</span> <span style=color:#0550ae>&amp;</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> check3 <span style=color:#0550ae>=</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>(</span>x <span style=color:#0550ae>^</span> <span style=color:#0550ae>0x38</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>int</span> check4 <span style=color:#0550ae>=</span> <span style=color:#0550ae>!</span><span style=color:#1f2328>(</span>x <span style=color:#0550ae>^</span> <span style=color:#0550ae>0x39</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> check1 <span style=color:#0550ae>&amp;</span> <span style=color:#1f2328>(</span>check2 <span style=color:#0550ae>|</span> check3 <span style=color:#0550ae>|</span> check4<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><h3 id=q7>q7</h3><h4 id=description-6>Description</h4><p>conditional - same as x ? y : z</p><h4 id=example-4>Example</h4><p>Example: conditional(2,4,5) = 4</p><h4 id=answer-6>Answer</h4><p>At first, we can use x = !x to make $f(x)= 0 {x\neq 0}, 1 {x = 0}$.</p><p>With x = ~x + 1, we can get $g(x) = ffff {x\neq 0 }, 0000{x=0}$.</p><p>Notice that y ^ y ^ z = z, y ^ 0 = y. Therefore, we can use y ^ ((y ^ z) & x) to get answer. When x = 0, (y ^ z) & x = y ^ z, otherwise, (y ^ z) & x = 0.</p><h4 id=code-6>Code</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cf222e>int</span> <span style=color:#6639ba>conditional</span><span style=color:#1f2328>(</span><span style=color:#cf222e>int</span> x<span style=color:#1f2328>,</span> <span style=color:#cf222e>int</span> y<span style=color:#1f2328>,</span> <span style=color:#cf222e>int</span> z<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    x <span style=color:#0550ae>=</span> <span style=color:#0550ae>!</span>x<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    x <span style=color:#0550ae>=</span> <span style=color:#0550ae>~</span>x <span style=color:#0550ae>+</span> <span style=color:#0550ae>1</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>return</span> y <span style=color:#0550ae>^</span> <span style=color:#1f2328>((</span>y <span style=color:#0550ae>^</span> z<span style=color:#1f2328>)</span> <span style=color:#0550ae>&amp;</span> x<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div></div><div class="row middle-xs"><div class=col-xs-12><div class=post-tags><a href=/categories/csapp/>/csapp</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer></div></div></div></article><script src=/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></body></html>