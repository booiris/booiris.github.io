<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.147.7"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://booiris.space/posts/linux/arch%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/"><link rel=canonical href=https://booiris.space/posts/linux/arch%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/><link rel=apple-touch-icon href=/avatar.svg><link rel=icon href=/avatar.svg><link rel=shortcut href=/avatar.svg><link rel=alternate type=application/atom+xml href=https://booiris.space/index.xml title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/booiris.space\/"},"articleSection":"posts","name":"arch虚拟机安装","headline":"arch虚拟机安装","description":"查看ip地址 ip addr 时间同步 timedatectl set-ntp true 准备磁盘分区 显示所有分区 fdisk -l 开始分区 fdisk \/dev\/sda 分区过程参考网址\n确认是否生效 fdisk -l \/dev\/sda 格式化分区和设置swap分区 mkfs.fat -F32 \/dev\/sda1 mkswap \/dev\/sda2 mkfs.ext4 \/dev\/sda3 启用交换分区 swapon \/dev\/sda2 挂载根目录 mount \/dev\/sda3 \/mnt 挂载boot目录 mkdir \/mnt\/boot mount \/dev\/sda1 \/mnt\/boot 安装系统 修改镜像源 vim \/etc\/pacman.d\/mirrorlist 添加 Server = http:\/\/mirrors.aliyun.com\/archlinux\/$repo\/os\/$arch 镜像\n如果安装时报错 ERROR: 5984EA8F3C could not be locally signed 解决办法：\nrm -fr \/etc\/pacman.d\/gnupg umount \/etc\/pacman.d\/gnupg rm -fr \/etc\/pacman.d\/gnupg pacman-key --init pacman-key --populate archlinux pacman -Sy archlinux-keyring 安装系统和网络插件 pacstrap \/mnt base linux networkmanager 配置系统 生成fstab文件 genfstab -U \/mnt \u0026gt;\u0026gt; \/mnt\/etc\/fstab 进入chroot arch-chroot \/mnt 设置时区 ln -sf \/usr\/share\/zoneinfo\/Asia\/Shanghai \/etc\/localtime 设置硬件时间同步 hwclock --systohc 安装vim pacman -S vim 语言设置 vim \/etc\/locale.gen en_US zh_CN 生成语言 locale-gen 设置默认语言 echo LANG=en_US.UTF-8 \u0026gt; \/etc\/locale.conf 创建host文件 echo YourNewHostname \u0026gt; \/etc\/hostname 添加host vim \/etc\/hosts # Static table lookup for hostnames. # See hosts(5) for details. 127.0.0.1 localhost ::1 localhost 127.0.1.1 YourNewHostname.localdomain YourNewHostname 开启网络服务 systemctl enable NetworkManager 设置 root 用户密码 passwd 安装引导程序 UEFI 系统：\n","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2022","datePublished":"2022-08-04 00:02:01 \u002b0000 UTC","dateModified":"2022-08-04 00:02:01 \u002b0000 UTC","url":"https:\/\/booiris.space\/posts\/linux\/arch%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85\/","keywords":[]}</script><title>arch虚拟机安装</title><meta property="og:title" content="arch虚拟机安装"><meta property="og:type" content="article"><meta property="og:description" content="查看ip地址 ip addr 时间同步 timedatectl set-ntp true 准备磁盘分区 显示所有分区 fdisk -l 开始分区 fdisk /dev/sda 分区过程参考网址
确认是否生效 fdisk -l /dev/sda 格式化分区和设置swap分区 mkfs.fat -F32 /dev/sda1 mkswap /dev/sda2 mkfs.ext4 /dev/sda3 启用交换分区 swapon /dev/sda2 挂载根目录 mount /dev/sda3 /mnt 挂载boot目录 mkdir /mnt/boot mount /dev/sda1 /mnt/boot 安装系统 修改镜像源 vim /etc/pacman.d/mirrorlist 添加 Server = http://mirrors.aliyun.com/archlinux/$repo/os/$arch 镜像
如果安装时报错 ERROR: 5984EA8F3C could not be locally signed 解决办法：
rm -fr /etc/pacman.d/gnupg umount /etc/pacman.d/gnupg rm -fr /etc/pacman.d/gnupg pacman-key --init pacman-key --populate archlinux pacman -Sy archlinux-keyring 安装系统和网络插件 pacstrap /mnt base linux networkmanager 配置系统 生成fstab文件 genfstab -U /mnt >> /mnt/etc/fstab 进入chroot arch-chroot /mnt 设置时区 ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 设置硬件时间同步 hwclock --systohc 安装vim pacman -S vim 语言设置 vim /etc/locale.gen en_US zh_CN 生成语言 locale-gen 设置默认语言 echo LANG=en_US.UTF-8 > /etc/locale.conf 创建host文件 echo YourNewHostname > /etc/hostname 添加host vim /etc/hosts # Static table lookup for hostnames. # See hosts(5) for details. 127.0.0.1 localhost ::1 localhost 127.0.1.1 YourNewHostname.localdomain YourNewHostname 开启网络服务 systemctl enable NetworkManager 设置 root 用户密码 passwd 安装引导程序 UEFI 系统：
"><meta name=description content="查看ip地址 ip addr 时间同步 timedatectl set-ntp true 准备磁盘分区 显示所有分区 fdisk -l 开始分区 fdisk /dev/sda 分区过程参考网址
确认是否生效 fdisk -l /dev/sda 格式化分区和设置swap分区 mkfs.fat -F32 /dev/sda1 mkswap /dev/sda2 mkfs.ext4 /dev/sda3 启用交换分区 swapon /dev/sda2 挂载根目录 mount /dev/sda3 /mnt 挂载boot目录 mkdir /mnt/boot mount /dev/sda1 /mnt/boot 安装系统 修改镜像源 vim /etc/pacman.d/mirrorlist 添加 Server = http://mirrors.aliyun.com/archlinux/$repo/os/$arch 镜像
如果安装时报错 ERROR: 5984EA8F3C could not be locally signed 解决办法：
rm -fr /etc/pacman.d/gnupg umount /etc/pacman.d/gnupg rm -fr /etc/pacman.d/gnupg pacman-key --init pacman-key --populate archlinux pacman -Sy archlinux-keyring 安装系统和网络插件 pacstrap /mnt base linux networkmanager 配置系统 生成fstab文件 genfstab -U /mnt >> /mnt/etc/fstab 进入chroot arch-chroot /mnt 设置时区 ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 设置硬件时间同步 hwclock --systohc 安装vim pacman -S vim 语言设置 vim /etc/locale.gen en_US zh_CN 生成语言 locale-gen 设置默认语言 echo LANG=en_US.UTF-8 > /etc/locale.conf 创建host文件 echo YourNewHostname > /etc/hostname 添加host vim /etc/hosts # Static table lookup for hostnames. # See hosts(5) for details. 127.0.0.1 localhost ::1 localhost 127.0.1.1 YourNewHostname.localdomain YourNewHostname 开启网络服务 systemctl enable NetworkManager 设置 root 用户密码 passwd 安装引导程序 UEFI 系统：
"><meta property="og:locale" content="cn"><meta property="og:image" content="/avatar.svg"><link rel=stylesheet href=/css/index.min.css><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.min.css><link href=/%20index.xml rel=alternate type=application/rss+xml title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css></head><body><article class="post 简体中文" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>HELLO WORLD</a></div><div class=header-subtitle>Live long and prosper.</div></header><div class="row end-md header-items"><div class=header-item><a href=/about target=_blank>About</a></div><div class=header-item><a href=https://github.com/booiris target=_blank>Github</a></div><div class=header-item><a href=/memos target=_blank>Memos</a></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>arch虚拟机安装</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2022-08-04 00:02:01 UTC">04 Aug 2022</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><h3 id=查看ip地址>查看ip地址</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ip addr
</span></span></code></pre></div><h3 id=时间同步>时间同步</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>timedatectl set-ntp <span style=color:#6639ba>true</span>
</span></span></code></pre></div><h2 id=准备磁盘分区>准备磁盘分区</h2><h3 id=显示所有分区>显示所有分区</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>fdisk -l
</span></span></code></pre></div><h3 id=开始分区>开始分区</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>fdisk /dev/sda
</span></span></code></pre></div><p>分区过程参考<a href=https://ericclose.github.io/Installing-Arch-as-a-guest-with-UEFI-and-GPT.html#arch-chroot>网址</a></p><h3 id=确认是否生效>确认是否生效</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span> fdisk -l /dev/sda
</span></span></code></pre></div><h3 id=格式化分区和设置swap分区>格式化分区和设置swap分区</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkfs.fat -F32 /dev/sda1
</span></span><span style=display:flex><span>mkswap /dev/sda2
</span></span><span style=display:flex><span>mkfs.ext4 /dev/sda3 
</span></span></code></pre></div><h3 id=启用交换分区>启用交换分区</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>swapon /dev/sda2
</span></span></code></pre></div><h3 id=挂载根目录>挂载根目录</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mount /dev/sda3 /mnt
</span></span></code></pre></div><h3 id=挂载boot目录>挂载boot目录</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /mnt/boot
</span></span><span style=display:flex><span>mount /dev/sda1 /mnt/boot
</span></span></code></pre></div><h2 id=安装系统>安装系统</h2><h3 id=修改镜像源>修改镜像源</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/pacman.d/mirrorlist
</span></span></code></pre></div><p>添加 <code>Server = http://mirrors.aliyun.com/archlinux/$repo/os/$arch</code> 镜像</p><p>如果安装时报错 <code>ERROR: 5984EA8F3C could not be locally signed</code> 解决办法：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>rm -fr /etc/pacman.d/gnupg
</span></span><span style=display:flex><span>umount /etc/pacman.d/gnupg
</span></span><span style=display:flex><span>rm -fr /etc/pacman.d/gnupg
</span></span><span style=display:flex><span>pacman-key --init
</span></span><span style=display:flex><span>pacman-key --populate archlinux
</span></span><span style=display:flex><span>pacman -Sy archlinux-keyring
</span></span></code></pre></div><h3 id=安装系统和网络插件>安装系统和网络插件</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>pacstrap /mnt base linux networkmanager
</span></span></code></pre></div><h2 id=配置系统>配置系统</h2><h3 id=生成fstab文件>生成fstab文件</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></div><h3 id=进入chroot>进入chroot</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>arch-chroot /mnt
</span></span></code></pre></div><h3 id=设置时区>设置时区</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span></code></pre></div><h3 id=设置硬件时间同步>设置硬件时间同步</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>hwclock --systohc
</span></span></code></pre></div><h3 id=安装vim>安装vim</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -S vim
</span></span></code></pre></div><h3 id=语言设置>语言设置</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span> vim /etc/locale.gen
</span></span><span style=display:flex><span> en_US
</span></span><span style=display:flex><span> zh_CN
</span></span></code></pre></div><h3 id=生成语言>生成语言</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>locale-gen
</span></span></code></pre></div><h3 id=设置默认语言>设置默认语言</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6639ba>echo</span> <span style=color:#953800>LANG</span><span style=color:#0550ae>=</span>en_US.UTF-8 &gt; /etc/locale.conf
</span></span></code></pre></div><h3 id=创建host文件>创建host文件</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6639ba>echo</span> YourNewHostname &gt; /etc/hostname
</span></span></code></pre></div><h3 id=添加host>添加host</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vim /etc/hosts
</span></span><span style=display:flex><span># Static table lookup for hostnames.  
</span></span><span style=display:flex><span># See hosts(5) for details.  
</span></span><span style=display:flex><span>127.0.0.1   localhost  
</span></span><span style=display:flex><span>::1         localhost  
</span></span><span style=display:flex><span>127.0.1.1   YourNewHostname.localdomain    YourNewHostname
</span></span></code></pre></div><h3 id=开启网络服务>开启网络服务</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl <span style=color:#6639ba>enable</span> NetworkManager
</span></span></code></pre></div><h3 id=设置-root-用户密码>设置 root 用户密码</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>passwd
</span></span></code></pre></div><h2 id=安装引导程序>安装引导程序</h2><p>UEFI 系统：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -S grub efibootmgr
</span></span><span style=display:flex><span>grub-install --target<span style=color:#0550ae>=</span>x86_64-efi --efi-directory<span style=color:#0550ae>=</span>/boot --bootloader-id<span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;Arch Linux&#34;</span> --recheck
</span></span><span style=display:flex><span>grub-mkconfig -o /boot/grub/grub.cfg 
</span></span></code></pre></div><h2 id=完成安装>完成安装</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6639ba>exit</span>
</span></span><span style=display:flex><span>umount -R /mnt
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><h3 id=备注>备注</h3><p>实体机安装类似，关闭显示屏</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>setterm -blank 1 # 待机一分钟关闭显示屏
</span></span></code></pre></div><p>在进入fakeroot后安装 intel-ucode,电源管理tlp</p></div><div class="row middle-xs"><div class=col-xs-12><div class=post-tags><a href=/categories/linux/>/linux</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer></div></div></div></article><script src=/%20js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("disqus_thread"),t=new MutationObserver(function(n){n.forEach(function(){const s=e.getElementsByTagName("iframe");if(s.length>1){const n=s[1];for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(n),t.disconnect()}})});t.observe(e,{childList:!0,subtree:!0})})</script></body></html>